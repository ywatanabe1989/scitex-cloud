[uwsgi]
# SciTeX Cloud uWSGI Configuration File

# Basic configuration
chdir           = /home/ywatanabe/proj/SciTeX-Cloud
module          = config.wsgi
home            = /home/ywatanabe/proj/SciTeX-Cloud/env

# Process-related settings
master          = true
processes       = 4
threads         = 2
enable-threads  = true

# Socket configuration
http            = :8000
# Uncomment for socket-based deployment with Nginx
# socket          = /var/run/scitex-cloud/uwsgi.sock
# chmod-socket    = 666

# Logging settings
logto           = /var/log/scitex-cloud/uwsgi.log
log-maxsize     = 100000000  # 100 MB before rotation
log-backupname  = /var/log/scitex-cloud/uwsgi.log.old

# Recycling and Performance settings
max-requests    = 5000
harakiri        = 30  # 30 seconds timeout
vacuum          = true
die-on-term     = true
thunder-lock    = true
buffer-size     = 65535

# Disable write exception tracebacks to make logs cleaner
catch-exceptions = true
disable-write-exception = true

# Response streaming
http-auto-chunked = true
add-header = X-Accel-Buffering: no

# Set environment variables
env = DJANGO_SETTINGS_MODULE=config.settings.production

# Optional: Cheaper subsystem for adaptive process spawning
# cheaper = 2
# cheaper-initial = 2
# cheaper-step = 1
# cheaper-algo = busyness
# cheaper-busyness-multiplier = 30
# cheaper-busyness-min = 20
# cheaper-busyness-max = 70
# cheaper-busyness-backlog-alert = 16
# cheaper-busyness-backlog-step = 2

# Python-specific settings
py-autoreload = 1  # Auto-reload on code change (only for development)
py-tracebacker = /var/log/scitex-cloud/uwsgi_tracebacker  # Path for py-tracebacker