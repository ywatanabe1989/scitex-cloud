{% extends "code_app/code_base.html" %}
{% load static %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'shared/css/components/hero.css' %}" />
    <style>
  .templates-hero {
    background: linear-gradient(
      135deg,
      var(--scitex-primary) 0%,
      var(--scitex-secondary) 100%
    );
    color: white;
    padding: 3rem 0;
    margin-bottom: 2rem;
  }

  .template-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .template-card {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 16px rgba(26, 35, 50, 0.1);
    border: 1px solid rgba(52, 73, 94, 0.1);
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .template-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 32px rgba(26, 35, 50, 0.15);
    border-color: var(--scitex-accent);
  }

  .template-icon {
    width: 64px;
    height: 64px;
    background: linear-gradient(
      135deg,
      var(--scitex-primary) 0%,
      var(--scitex-secondary) 100%
    );
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    margin-bottom: 1.5rem;
  }

  .template-tags {
    margin: 1rem 0;
  }

  .template-tag {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: var(--scitex-accent);
    color: white;
    border-radius: 12px;
    font-size: 0.75rem;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .code-preview {
    background: #1a1a1a;
    color: #f8f8f2;
    padding: 1rem;
    border-radius: 8px;
    font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
    font-size: 0.75rem;
    overflow-x: auto;
    max-height: 200px;
    overflow-y: auto;
    margin-top: 1rem;
  }

  .template-actions {
    margin-top: 1.5rem;
    display: flex;
    gap: 0.5rem;
  }

  .use-template-btn {
    background: var(--scitex-accent);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.3s ease;
    flex: 1;
  }

  .use-template-btn:hover {
    background: #2980b9;
    transform: translateY(-1px);
  }

  .copy-template-btn {
    background: transparent;
    color: var(--scitex-accent);
    border: 1px solid var(--scitex-accent);
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .copy-template-btn:hover {
    background: var(--scitex-accent);
    color: white;
  }

  .filter-tabs {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    border-bottom: 2px solid #e9ecef;
    padding-bottom: 1rem;
  }

  .filter-tab {
    padding: 0.5rem 1rem;
    background: transparent;
    border: none;
    color: #6c757d;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .filter-tab.active {
    background: var(--scitex-accent);
    color: white;
  }

  .template-difficulty {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: bold;
    text-transform: uppercase;
  }

  .difficulty-beginner {
    background: #d4edda;
    color: #155724;
  }
  .difficulty-intermediate {
    background: #fff3cd;
    color: #856404;
  }
  .difficulty-advanced {
    background: #f8d7da;
    color: #721c24;
  }
    </style>
{% endblock %}
{% block code_content %}
    <div class="templates-hero silverish-ai-gradient">
        <div class="container">
            <div class="text-center">
                <h1 class="display-4 fw-bold mb-3">SCITEX Framework Templates</h1>
                <p class="lead mb-4">Ready-to-use scientific computing templates for reproducible research</p>
                <div class="d-flex justify-content-center gap-3">
                    <a href="{% url 'code:editor' %}" class="btn btn-light btn-lg">
                        <i class="fas fa-code me-2"></i>Open Editor
                    </a>
                    <a href="{% url 'code:analysis' %}" class="btn btn-outline-light btn-lg">
                        <i class="fas fa-chart-bar me-2"></i>Data Analysis
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <!-- Filter Tabs -->
        <div class="filter-tabs">
            <button class="filter-tab active" onclick="filterTemplates('all')">All Templates</button>
            <button class="filter-tab" onclick="filterTemplates('data-analysis')">Data Analysis</button>
            <button class="filter-tab" onclick="filterTemplates('machine-learning')">Machine Learning</button>
            <button class="filter-tab" onclick="filterTemplates('visualization')">Visualization</button>
            <button class="filter-tab" onclick="filterTemplates('statistics')">Statistics</button>
            <button class="filter-tab" onclick="filterTemplates('research')">Research Tools</button>
        </div>
        <!-- Templates Grid -->
        <div class="template-grid" id="templates-grid">
            <!-- Statistical Analysis Template -->
            <div class="template-card"
                 data-category="statistics data-analysis"
                 data-template="statistical_analysis">
                <div class="template-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h4>Statistical Analysis</h4>
                    <span class="template-difficulty difficulty-beginner">Beginner</span>
                </div>
                <p class="text-muted mb-3">
                    Comprehensive statistical analysis with descriptive statistics,
                    hypothesis testing, and correlation analysis using SCITEX framework.
                </p>
                <div class="template-tags">
                    <span class="template-tag">Pandas</span>
                    <span class="template-tag">SciPy</span>
                    <span class="template-tag">SCITEX</span>
                    <span class="template-tag">Statistics</span>
                </div>
                <div class="code-preview">
                    import pandas as pd import numpy as np from scipy import stats from
                    scitex import io, stats as scistats, plt as splt # Load data with SCITEX
                    framework data = io.load_data('your_data.csv') # Statistical analysis
                    results = scistats.descriptive_statistics(data) normality_test =
                    scistats.test_normality(data['target_column']) # Generate
                    publication-ready visualizations fig = splt.create_figure(figsize=(12,
                    8)) splt.plot_distribution(data['target_column'])
                    splt.save_figure('statistical_analysis.png', dpi=300)
                </div>
                <div class="template-actions">
                    <button class="use-template-btn"
                            onclick="useTemplate('statistical_analysis')">
                        <i class="fas fa-play me-1"></i>Use Template
                    </button>
                    <button class="copy-template-btn"
                            onclick="copyTemplate('statistical_analysis')">
                        <i class="fas fa-copy me-1"></i>Copy
                    </button>
                </div>
            </div>
            <!-- Machine Learning Template -->
            <div class="template-card"
                 data-category="machine-learning data-analysis"
                 data-template="machine_learning">
                <div class="template-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h4>Machine Learning Pipeline</h4>
                    <span class="template-difficulty difficulty-intermediate">Intermediate</span>
                </div>
                <p class="text-muted mb-3">
                    Complete ML pipeline with data preprocessing, model training,
                    evaluation, and hyperparameter tuning using scikit-learn and SCITEX.
                </p>
                <div class="template-tags">
                    <span class="template-tag">Scikit-learn</span>
                    <span class="template-tag">NumPy</span>
                    <span class="template-tag">SCITEX</span>
                    <span class="template-tag">ML</span>
                </div>
                <div class="code-preview">
                    import pandas as pd import numpy as np from sklearn.model_selection
                    import train_test_split from sklearn.ensemble import
                    RandomForestClassifier from sklearn.metrics import classification_report
                    from scitex import io, ml, plt as splt # Load and prepare data data =
                    io.load_data('dataset.csv') X, y = ml.prepare_features(data,
                    target='target_column') # Split and train X_train, X_test, y_train,
                    y_test = train_test_split(X, y, test_size=0.2) model =
                    ml.create_model('random_forest') model.fit(X_train, y_train) # Evaluate
                    and visualize predictions = model.predict(X_test)
                    ml.evaluate_model(y_test, predictions)
                    splt.plot_model_performance(y_test, predictions)
                </div>
                <div class="template-actions">
                    <button class="use-template-btn" onclick="useTemplate('machine_learning')">
                        <i class="fas fa-play me-1"></i>Use Template
                    </button>
                    <button class="copy-template-btn" onclick="copyTemplate('machine_learning')">
                        <i class="fas fa-copy me-1"></i>Copy
                    </button>
                </div>
            </div>
            <!-- Time Series Analysis Template -->
            <div class="template-card"
                 data-category="data-analysis statistics"
                 data-template="time_series">
                <div class="template-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h4>Time Series Analysis</h4>
                    <span class="template-difficulty difficulty-intermediate">Intermediate</span>
                </div>
                <p class="text-muted mb-3">
                    Time series analysis with trend detection, seasonal decomposition, and
                    forecasting using ARIMA models and SCITEX utilities.
                </p>
                <div class="template-tags">
                    <span class="template-tag">Pandas</span>
                    <span class="template-tag">Statsmodels</span>
                    <span class="template-tag">SCITEX</span>
                    <span class="template-tag">Forecasting</span>
                </div>
                <div class="code-preview">
                    import pandas as pd import numpy as np from statsmodels.tsa.seasonal
                    import seasonal_decompose from statsmodels.tsa.arima.model import ARIMA
                    from scitex import io, timeseries as ts, plt as splt # Load and prepare
                    time series data data = io.load_data('timeseries_data.csv') data['date']
                    = pd.to_datetime(data['date']) ts_data = data.set_index('date')['value']
                    # Time series analysis decomposition = ts.decompose_series(ts_data)
                    trend_analysis = ts.analyze_trend(ts_data) # Forecasting forecast =
                    ts.forecast_arima(ts_data, periods=30) # Visualization
                    splt.plot_timeseries_analysis(ts_data, decomposition, forecast)
                </div>
                <div class="template-actions">
                    <button class="use-template-btn" onclick="useTemplate('time_series')">
                        <i class="fas fa-play me-1"></i>Use Template
                    </button>
                    <button class="copy-template-btn" onclick="copyTemplate('time_series')">
                        <i class="fas fa-copy me-1"></i>Copy
                    </button>
                </div>
            </div>
            <!-- Scientific Plotting Template -->
            <div class="template-card"
                 data-category="visualization research"
                 data-template="scientific_plotting">
                <div class="template-icon">
                    <i class="fas fa-chart-area"></i>
                </div>
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h4>Scientific Plotting</h4>
                    <span class="template-difficulty difficulty-beginner">Beginner</span>
                </div>
                <p class="text-muted mb-3">
                    Create publication-ready scientific figures with proper formatting,
                    error bars, and statistical annotations using SCITEX plotting utilities.
                </p>
                <div class="template-tags">
                    <span class="template-tag">Matplotlib</span>
                    <span class="template-tag">Seaborn</span>
                    <span class="template-tag">SCITEX</span>
                    <span class="template-tag">Publication</span>
                </div>
                <div class="code-preview">
                    import numpy as np import pandas as pd from scitex import plt as splt,
                    io # Load experimental data data =
                    io.load_data('experiment_results.csv') # Create publication-ready figure
                    fig = splt.create_figure(figsize=(10, 6), style='publication') # Plot
                    with error bars and statistical annotations splt.plot_experimental_data(
                    data['treatment'], data['response'], errors=data['error'],
                    title='Treatment Effects on Response Variable' ) # Add statistical
                    annotations splt.add_significance_bars(data, p_values=[0.01, 0.05]) #
                    Save with publication settings
                    splt.save_figure('experiment_results.png', dpi=300, format='png')
                    splt.save_figure('experiment_results.pdf', format='pdf')
                </div>
                <div class="template-actions">
                    <button class="use-template-btn" onclick="useTemplate('scientific_plotting')">
                        <i class="fas fa-play me-1"></i>Use Template
                    </button>
                    <button class="copy-template-btn"
                            onclick="copyTemplate('scientific_plotting')">
                        <i class="fas fa-copy me-1"></i>Copy
                    </button>
                </div>
            </div>
            <!-- Bioinformatics Analysis Template -->
            <div class="template-card"
                 data-category="data-analysis research"
                 data-template="bioinformatics">
                <div class="template-icon">
                    <i class="fas fa-dna"></i>
                </div>
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h4>Bioinformatics Analysis</h4>
                    <span class="template-difficulty difficulty-advanced">Advanced</span>
                </div>
                <p class="text-muted mb-3">
                    Genomic data analysis with sequence processing, gene expression
                    analysis, and pathway enrichment using BioPython and SCITEX.
                </p>
                <div class="template-tags">
                    <span class="template-tag">BioPython</span>
                    <span class="template-tag">Pandas</span>
                    <span class="template-tag">SCITEX</span>
                    <span class="template-tag">Genomics</span>
                </div>
                <div class="code-preview">
                    import pandas as pd import numpy as np from Bio import SeqIO, Entrez
                    from scitex import io, bio, plt as splt # Load genomic data sequences =
                    io.load_sequences('sequences.fasta') expression_data =
                    io.load_data('gene_expression.csv') # Sequence analysis seq_stats =
                    bio.analyze_sequences(sequences) gc_content =
                    bio.calculate_gc_content(sequences) # Gene expression analysis
                    diff_genes = bio.differential_expression(expression_data)
                    pathway_results = bio.pathway_enrichment(diff_genes) # Visualization fig
                    = splt.create_figure(figsize=(15, 10)) splt.plot_volcano(diff_genes,
                    title='Differential Gene Expression')
                    splt.plot_pathway_enrichment(pathway_results)
                    splt.save_figure('bioinformatics_analysis.png', dpi=300)
                </div>
                <div class="template-actions">
                    <button class="use-template-btn" onclick="useTemplate('bioinformatics')">
                        <i class="fas fa-play me-1"></i>Use Template
                    </button>
                    <button class="copy-template-btn" onclick="copyTemplate('bioinformatics')">
                        <i class="fas fa-copy me-1"></i>Copy
                    </button>
                </div>
            </div>
            <!-- Image Analysis Template -->
            <div class="template-card"
                 data-category="data-analysis research"
                 data-template="image_analysis">
                <div class="template-icon">
                    <i class="fas fa-image"></i>
                </div>
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h4>Scientific Image Analysis</h4>
                    <span class="template-difficulty difficulty-intermediate">Intermediate</span>
                </div>
                <p class="text-muted mb-3">
                    Microscopy and scientific image processing with feature extraction,
                    measurement, and quantitative analysis using OpenCV and SCITEX.
                </p>
                <div class="template-tags">
                    <span class="template-tag">OpenCV</span>
                    <span class="template-tag">scikit-image</span>
                    <span class="template-tag">SCITEX</span>
                    <span class="template-tag">Microscopy</span>
                </div>
                <div class="code-preview">
                    import cv2 import numpy as np from skimage import measure, segmentation
                    from scitex import io, image as scimg, plt as splt # Load microscopy
                    images images = io.load_images('microscopy_data/') # Image processing
                    pipeline processed_images = [] measurements = [] for img in images: #
                    Preprocessing cleaned = scimg.preprocess_microscopy(img) # Segmentation
                    cells = scimg.segment_cells(cleaned) # Feature extraction features =
                    scimg.extract_cell_features(cells) measurements.append(features)
                    processed_images.append(cells) # Analysis and visualization results =
                    scimg.analyze_cell_population(measurements)
                    splt.plot_image_analysis_results(processed_images, results)
                </div>
                <div class="template-actions">
                    <button class="use-template-btn" onclick="useTemplate('image_analysis')">
                        <i class="fas fa-play me-1"></i>Use Template
                    </button>
                    <button class="copy-template-btn" onclick="copyTemplate('image_analysis')">
                        <i class="fas fa-copy me-1"></i>Copy
                    </button>
                </div>
            </div>
            <!-- Research Paper Analysis Template -->
            <div class="template-card"
                 data-category="research data-analysis"
                 data-template="research_analysis">
                <div class="template-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h4>Research Paper Analysis</h4>
                    <span class="template-difficulty difficulty-intermediate">Intermediate</span>
                </div>
                <p class="text-muted mb-3">
                    Automated research paper analysis with citation network analysis, topic
                    modeling, and trend detection using NLP and SCITEX.
                </p>
                <div class="template-tags">
                    <span class="template-tag">NLTK</span>
                    <span class="template-tag">NetworkX</span>
                    <span class="template-tag">SCITEX</span>
                    <span class="template-tag">NLP</span>
                </div>
                <div class="code-preview">
                    import pandas as pd import numpy as np import networkx as nx from
                    sklearn.feature_extraction.text import TfidfVectorizer from scitex
                    import io, nlp, network, plt as splt # Load research papers data papers
                    = io.load_data('papers_dataset.csv') # Text analysis abstracts =
                    papers['abstract'].tolist() topics = nlp.extract_topics(abstracts,
                    n_topics=10) keywords = nlp.extract_keywords(abstracts) # Citation
                    network analysis citation_network =
                    network.build_citation_network(papers) centrality =
                    network.calculate_centrality(citation_network) communities =
                    network.detect_communities(citation_network) # Visualization fig =
                    splt.create_figure(figsize=(15, 12))
                    splt.plot_topic_distribution(topics)
                    splt.plot_citation_network(citation_network, communities)
                    splt.save_figure('research_analysis.png', dpi=300)
                </div>
                <div class="template-actions">
                    <button class="use-template-btn" onclick="useTemplate('research_analysis')">
                        <i class="fas fa-play me-1"></i>Use Template
                    </button>
                    <button class="copy-template-btn" onclick="copyTemplate('research_analysis')">
                        <i class="fas fa-copy me-1"></i>Copy
                    </button>
                </div>
            </div>
            <!-- Experimental Design Template -->
            <div class="template-card"
                 data-category="research statistics"
                 data-template="experimental_design">
                <div class="template-icon">
                    <i class="fas fa-flask"></i>
                </div>
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h4>Experimental Design & Analysis</h4>
                    <span class="template-difficulty difficulty-advanced">Advanced</span>
                </div>
                <p class="text-muted mb-3">
                    Complete experimental design with power analysis, randomization, ANOVA,
                    and post-hoc testing using SCITEX statistical utilities.
                </p>
                <div class="template-tags">
                    <span class="template-tag">SciPy</span>
                    <span class="template-tag">Statsmodels</span>
                    <span class="template-tag">SCITEX</span>
                    <span class="template-tag">Experimental</span>
                </div>
                <div class="code-preview">
                    import pandas as pd import numpy as np from scipy import stats import
                    statsmodels.api as sm from scitex import io, experimental as exp, plt as
                    splt # Load experimental data data = io.load_data('experiment_data.csv')
                    # Power analysis power_analysis = exp.calculate_power(effect_size=0.5,
                    alpha=0.05) sample_size = exp.estimate_sample_size(effect_size=0.5,
                    power=0.8) # ANOVA analysis anova_results = exp.perform_anova(data,
                    factors=['treatment', 'time']) posthoc_results =
                    exp.posthoc_analysis(data, method='tukey') # Effect size calculations
                    effect_sizes = exp.calculate_effect_sizes(data) # Visualization fig =
                    splt.create_figure(figsize=(15, 10))
                    splt.plot_experimental_results(data, anova_results)
                    splt.plot_effect_sizes(effect_sizes)
                    splt.save_figure('experimental_analysis.png', dpi=300)
                </div>
                <div class="template-actions">
                    <button class="use-template-btn" onclick="useTemplate('experimental_design')">
                        <i class="fas fa-play me-1"></i>Use Template
                    </button>
                    <button class="copy-template-btn"
                            onclick="copyTemplate('experimental_design')">
                        <i class="fas fa-copy me-1"></i>Copy
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
  // Template code storage
  const templateCodes = {
    statistical_analysis: `import pandas as pd
import numpy as np
from scipy import stats
from scitex import io, stats as scistats, plt as splt

# Load data with SCITEX framework
data = io.load_data('your_data.csv')

# Basic data exploration
print("Data Overview:")
print(data.info())
print("\\nFirst few rows:")
print(data.head())

# Statistical analysis
results = scistats.descriptive_statistics(data)
print("\\nDescriptive Statistics:")
print(results)

# Normality testing
numeric_columns = data.select_dtypes(include=[np.number]).columns
for col in numeric_columns[:3]:  # Test first 3 numeric columns
    normality_test = scistats.test_normality(data[col])
    print(f"\\nNormality test for {col}:")
    print(f"  Shapiro-Wilk p-value: {normality_test['p_value']:.4f}")
    print(f"  Is normal: {normality_test['is_normal']}")

# Correlation analysis
if len(numeric_columns) > 1:
    correlations = scistats.correlation_matrix(data[numeric_columns])
    print("\\nCorrelation Matrix:")
    print(correlations)

# Generate publication-ready visualizations
fig = splt.create_figure(figsize=(12, 8))
if len(numeric_columns) > 0:
    target_col = numeric_columns[0]
    splt.plot_distribution(data[target_col], title=f'Distribution of {target_col}')
    splt.save_figure('statistical_analysis.png', dpi=300)
    print(f"\\nDistribution plot saved for {target_col}")

print("\\nStatistical analysis complete!")`,

    machine_learning: `import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split, cross_val_score
from sklearn.ensemble import RandomForestClassifier, RandomForestRegressor
from sklearn.metrics import classification_report, mean_squared_error, r2_score
from sklearn.preprocessing import StandardScaler, LabelEncoder
from scitex import io, ml, plt as splt

# Load and prepare data
data = io.load_data('your_dataset.csv')
print("Data loaded successfully!")
print(f"Shape: {data.shape}")

# Identify target column (assuming last column is target)
target_column = data.columns[-1]
feature_columns = data.columns[:-1]

print(f"\\nTarget column: {target_column}")
print(f"Feature columns: {list(feature_columns)}")

# Prepare features and target
X = data[feature_columns]
y = data[target_column]

# Handle categorical variables
categorical_cols = X.select_dtypes(include=['object']).columns
for col in categorical_cols:
    le = LabelEncoder()
    X[col] = le.fit_transform(X[col].astype(str))

# Determine if classification or regression
is_classification = len(y.unique()) < 20 and y.dtype in ['object', 'int64']

if is_classification:
    if y.dtype == 'object':
        le_target = LabelEncoder()
        y = le_target.fit_transform(y)
    model = RandomForestClassifier(n_estimators=100, random_state=42)
    print("\\nUsing Random Forest Classifier")
else:
    model = RandomForestRegressor(n_estimators=100, random_state=42)
    print("\\nUsing Random Forest Regressor")

# Split data
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y if is_classification else None
)

# Scale features
scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

# Train model
model.fit(X_train_scaled, y_train)

# Make predictions
predictions = model.predict(X_test_scaled)

# Evaluate model
print("\\nModel Performance:")
if is_classification:
    print(classification_report(y_test, predictions))
    cv_scores = cross_val_score(model, X_train_scaled, y_train, cv=5)
    print(f"Cross-validation accuracy: {cv_scores.mean():.3f} (+/- {cv_scores.std() * 2:.3f})")
else:
    mse = mean_squared_error(y_test, predictions)
    r2 = r2_score(y_test, predictions)
    print(f"Mean Squared Error: {mse:.3f}")
    print(f"R² Score: {r2:.3f}")
    cv_scores = cross_val_score(model, X_train_scaled, y_train, cv=5, scoring='r2')
    print(f"Cross-validation R²: {cv_scores.mean():.3f} (+/- {cv_scores.std() * 2:.3f})")

# Feature importance
feature_importance = pd.DataFrame({
    'feature': feature_columns,
    'importance': model.feature_importances_
}).sort_values('importance', ascending=False)

print("\\nTop 10 Most Important Features:")
print(feature_importance.head(10))

# Visualization
fig = splt.create_figure(figsize=(15, 10))
splt.plot_model_performance(y_test, predictions, model_type='classification' if is_classification else 'regression')
splt.save_figure('ml_analysis.png', dpi=300)

print("\\nMachine learning analysis complete!")
print("Results saved to ml_analysis.png")`,

    scientific_plotting: `import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from scitex import plt as splt, io

# Set publication-ready style
plt.style.use('seaborn-v0_8-whitegrid')
sns.set_palette("husl")

# Generate sample experimental data (replace with your data loading)
np.random.seed(42)
n_groups = 4
n_samples = 20

data = {
    'treatment': np.repeat(['Control', 'Treatment A', 'Treatment B', 'Treatment C'], n_samples),
    'response': np.concatenate([
        np.random.normal(10, 2, n_samples),  # Control
        np.random.normal(15, 2.5, n_samples),  # Treatment A
        np.random.normal(18, 3, n_samples),  # Treatment B
        np.random.normal(12, 2, n_samples)   # Treatment C
    ]),
    'error': np.random.uniform(0.5, 2, n_groups * n_samples)
}

df = pd.DataFrame(data)

# Calculate summary statistics
summary_stats = df.groupby('treatment')['response'].agg(['mean', 'std', 'sem']).reset_index()
print("Summary Statistics:")
print(summary_stats)

# Create publication-ready figure
fig = splt.create_figure(figsize=(12, 8), style='publication')

# Main plot: Bar plot with error bars
ax = plt.gca()
bars = ax.bar(summary_stats['treatment'], summary_stats['mean'], 
              yerr=summary_stats['sem'], capsize=5, alpha=0.8,
              color=['#3498db', '#e74c3c', '#2ecc71', '#f39c12'])

# Add individual data points
for i, treatment in enumerate(summary_stats['treatment']):
    treatment_data = df[df['treatment'] == treatment]['response']
    x_pos = np.random.normal(i, 0.04, len(treatment_data))
    ax.scatter(x_pos, treatment_data, alpha=0.6, s=30, color='black')

# Formatting
ax.set_xlabel('Treatment Group', fontsize=14, fontweight='bold')
ax.set_ylabel('Response Variable (units)', fontsize=14, fontweight='bold')
ax.set_title('Treatment Effects on Response Variable', fontsize=16, fontweight='bold', pad=20)

# Add statistical annotations (mock p-values)
def add_significance_bar(ax, x1, x2, y, p_value):
    h = y * 0.02
    ax.plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c='black')
    if p_value < 0.001:
        sig_text = '***'
    elif p_value < 0.01:
        sig_text = '**'
    elif p_value < 0.05:
        sig_text = '*'
    else:
        sig_text = 'ns'
    ax.text((x1+x2)*0.5, y+h, sig_text, ha='center', va='bottom', fontweight='bold')

# Add significance bars
max_y = summary_stats['mean'].max() + summary_stats['sem'].max()
add_significance_bar(ax, 0, 1, max_y * 1.1, 0.01)  # Control vs Treatment A
add_significance_bar(ax, 0, 2, max_y * 1.2, 0.001)  # Control vs Treatment B
add_significance_bar(ax, 1, 2, max_y * 1.05, 0.05)  # Treatment A vs Treatment B

# Styling
ax.spines['top'].set_visible(False)
ax.spines['right'].set_visible(False)
ax.tick_params(axis='both', which='major', labelsize=12)
ax.grid(axis='y', alpha=0.3)

plt.tight_layout()

# Save with publication settings
splt.save_figure('scientific_plot.png', dpi=300, format='png')
splt.save_figure('scientific_plot.pdf', format='pdf')

print("\\nPublication-ready scientific plot created!")
print("Saved as:")
print("- scientific_plot.png (300 DPI)")
print("- scientific_plot.pdf (vector format)")

# Create additional subplot figure
fig, axes = plt.subplots(2, 2, figsize=(12, 10))
fig.suptitle('Multi-panel Scientific Figure', fontsize=16, fontweight='bold')

# Panel A: Box plot
axes[0,0].boxplot([df[df['treatment'] == t]['response'] for t in summary_stats['treatment']], 
                  labels=summary_stats['treatment'])
axes[0,0].set_title('A) Distribution by Treatment', fontweight='bold')
axes[0,0].set_ylabel('Response Variable')

# Panel B: Scatter plot with regression
axes[0,1].scatter(df.index, df['response'], alpha=0.6)
z = np.polyfit(df.index, df['response'], 1)
p = np.poly1d(z)
axes[0,1].plot(df.index, p(df.index), "r--", alpha=0.8)
axes[0,1].set_title('B) Temporal Trend', fontweight='bold')
axes[0,1].set_xlabel('Sample Order')
axes[0,1].set_ylabel('Response Variable')

# Panel C: Histogram
axes[1,0].hist(df['response'], bins=20, alpha=0.7, edgecolor='black')
axes[1,0].set_title('C) Overall Distribution', fontweight='bold')
axes[1,0].set_xlabel('Response Variable')
axes[1,0].set_ylabel('Frequency')

# Panel D: Correlation heatmap (mock data)
corr_data = np.random.randn(5, 5)
corr_data = np.corrcoef(corr_data)
im = axes[1,1].imshow(corr_data, cmap='RdBu_r', aspect='auto', vmin=-1, vmax=1)
axes[1,1].set_title('D) Correlation Matrix', fontweight='bold')
plt.colorbar(im, ax=axes[1,1])

plt.tight_layout()
plt.savefig('multi_panel_figure.png', dpi=300, bbox_inches='tight')

print("\\nMulti-panel figure saved as multi_panel_figure.png")`,
  };

  // Filter functionality
  function filterTemplates(category) {
    // Update active tab
    document
      .querySelectorAll(".filter-tab")
      .forEach((tab) => tab.classList.remove("active"));
    event.target.classList.add("active");

    // Show/hide templates
    const templates = document.querySelectorAll(".template-card");
    templates.forEach((template) => {
      if (category === "all" || template.dataset.category.includes(category)) {
        template.style.display = "block";
      } else {
        template.style.display = "none";
      }
    });
  }

  // Use template functionality
  function useTemplate(templateName) {
    if (templateCodes[templateName]) {
      // Redirect to editor with template code
      localStorage.setItem("templateCode", templateCodes[templateName]);
      window.location.href = '{% url "code:editor" %}';
    } else {
      alert("Template code not available. Please try again.");
    }
  }

  // Copy template functionality
  function copyTemplate(templateName) {
    if (templateCodes[templateName]) {
      navigator.clipboard
        .writeText(templateCodes[templateName])
        .then(() => {
          // Show success feedback
          const button = event.target;
          const originalText = button.innerHTML;
          button.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
          button.style.background = "#27ae60";

          setTimeout(() => {
            button.innerHTML = originalText;
            button.style.background = "";
          }, 2000);
        })
        .catch((err) => {
          alert("Failed to copy template code.");
        });
    }
  }

  // Load template code in editor if coming from templates page
  document.addEventListener("DOMContentLoaded", function () {
    const templateCode = localStorage.getItem("templateCode");
    if (templateCode && window.location.pathname.includes("/editor/")) {
      // This would be handled in the editor page
      localStorage.removeItem("templateCode");
    }
  });
    </script>
    <!-- CSRF token -->
    {% csrf_token %}
{% endblock %}
