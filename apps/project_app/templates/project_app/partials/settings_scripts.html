<script>
// Radio button selection visual feedback
document.querySelectorAll('.radio-option input[type="radio"]').forEach(radio => {
    radio.addEventListener('change', function() {
        document.querySelectorAll('.radio-option').forEach(opt => opt.classList.remove('selected'));
        this.closest('.radio-option').classList.add('selected');
    });
});

// GitHub-style Delete Modal
function showDeleteModal() {
    const modal = document.getElementById('deleteModal');
    modal.style.display = 'flex';
    document.getElementById('deleteConfirmInput').value = '';
    document.getElementById('deleteConfirmButton').disabled = true;
}

function hideDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
}

function checkDeleteInput() {
    const input = document.getElementById('deleteConfirmInput');
    const button = document.getElementById('deleteConfirmButton');
    const expectedValue = '{{ user.username }}/{{ project.name }}';

    if (input.value === expectedValue) {
        button.disabled = false;
        button.style.opacity = '1';
    } else {
        button.disabled = true;
        button.style.opacity = '0.5';
    }
}

function submitDelete() {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = window.location.href;

    const csrfInput = document.createElement('input');
    csrfInput.type = 'hidden';
    csrfInput.name = 'csrfmiddlewaretoken';
    csrfInput.value = document.querySelector('[name=csrfmiddlewaretoken]').value;

    const actionInput = document.createElement('input');
    actionInput.type = 'hidden';
    actionInput.name = 'action';
    actionInput.value = 'delete_repository';

    form.appendChild(csrfInput);
    form.appendChild(actionInput);
    document.body.appendChild(form);
    form.submit();
}

// Close modal on ESC key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        hideDeleteModal();
    }
});

// Add collaborator button feedback
const addCollaboratorBtn = document.getElementById('addCollaboratorBtn');
const collaboratorUsername = document.getElementById('collaboratorUsername');
const addBtnText = document.getElementById('addBtnText');

if (addCollaboratorBtn && collaboratorUsername) {
    // Show loading state when form submits via this button
    addCollaboratorBtn.addEventListener('click', function(e) {
        const username = collaboratorUsername.value.trim();
        if (username) {
            addBtnText.textContent = 'Adding...';
            addCollaboratorBtn.disabled = true;
            addCollaboratorBtn.style.opacity = '0.7';
            console.log('Adding collaborator:', username);
        } else {
            e.preventDefault();
            alert('Please enter a username');
        }
    });

    // Reset button when username input changes
    collaboratorUsername.addEventListener('input', function() {
        if (addCollaboratorBtn.disabled) {
            addBtnText.textContent = 'Add collaborator';
            addCollaboratorBtn.disabled = false;
            addCollaboratorBtn.style.opacity = '1';
        }
    });
}
</script>
