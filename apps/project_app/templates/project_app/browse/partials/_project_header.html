<!-- Repository Header -->
<div class="repo-header">
    <div class="repo-header-main">
        <!-- Left: User / Repo + Branch Selector + Breadcrumbs -->
        <div class="repo-header-left">
            <a href="/{{ project.owner.username }}/" class="repo-header-owner">
                {{ project.owner.username }}
            </a>
            <span class="repo-header-separator">/</span>
            <a href="/{{ project.owner.username }}/{{ project.slug }}/" class="repo-title">
                {{ project.name }}
            </a>
            {% if breadcrumbs %}
                {% for breadcrumb in breadcrumbs %}
                    {% if breadcrumb.name != project.name %}
                        <span class="repo-header-separator">/</span>
                        {% if forloop.last %}
                            <span class="repo-breadcrumb-current">{{ breadcrumb.name }}</span>
                        {% else %}
                            <a href="{{ breadcrumb.url }}" class="repo-breadcrumb-item">
                                {{ breadcrumb.name }}
                            </a>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            {% endif %}

            <!-- Branch Selector Dropdown -->
            <div class="btn-group repo-branch-selector">
                <button class="repo-action-btn" id="branch-dropdown-btn-header" type="button" onclick="toggleBranchDropdown()">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" class="icon-inline">
                        <path d="M9.5 3.25a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.493 2.493 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25Zm-6 0a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0Zm8.25-.75a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Z"/>
                    </svg>
                    <span class="repo-branch-name" id="current-branch-name">{{ current_branch|default:"develop" }}</span>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" class="icon-inline-ml">
                        <path d="m4.427 7.427 3.396 3.396a.25.25 0 0 0 .354 0l3.396-3.396A.25.25 0 0 0 11.396 7H4.604a.25.25 0 0 0-.177.427Z"/>
                    </svg>
                </button>
                <div class="dropdown-menu branch-dropdown-menu" id="branch-dropdown-menu">
                    <div class="branch-search-container">
                        <input type="text" id="branch-search-input" placeholder="Find or create a branch..." class="branch-search-input">
                    </div>
                    <div class="branch-list-container">
                        <div class="branch-list-header">Branches</div>
                        <div id="branch-list">
                            {% for branch in branches %}
                            <a href="#" class="branch-item" data-branch="{{ branch }}">
                                {% if branch == current_branch %}
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" class="icon-inline-mr icon-success">
                                    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/>
                                </svg>
                                <strong>{{ branch }}</strong>{% if branch == 'main' or branch == 'develop' %} (default){% endif %}
                                {% else %}
                                <span class="branch-item-indent">{{ branch }}</span>
                                {% endif %}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Branch/Tags count links (GitHub-style) -->
            <div class="repo-branch-count-links">
                <a href="/{{ project.owner.username }}/{{ project.slug }}/branches/" class="repo-branch-count-link">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" class="icon-inline">
                        <path d="M9.5 3.25a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.493 2.493 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25Zm-6 0a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0Zm8.25-.75a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Z"/>
                    </svg>
                    <strong>{{ branches|length }}</strong> Branch{{ branches|length|pluralize:"es" }}
                </a>
                <a href="/{{ project.owner.username }}/{{ project.slug }}/tags/" class="repo-branch-count-link">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" class="icon-inline">
                        <path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/>
                    </svg>
                    <strong>0</strong> Tags
                </a>
            </div>
        </div>

        <!-- Right: Action Buttons (Watch, Star, Fork) -->
        <div class="repo-action-buttons">
            <!-- Watch Button -->
            <button class="repo-action-btn{% if is_watching %} active{% endif %}" id="watch-btn" onclick="handleWatch(event)" data-username="{{ project.owner.username }}" data-slug="{{ project.slug }}">
                <svg class="repo-action-icon" viewBox="0 0 16 16" width="16" height="16">
                    <path d="M8 2c1.981 0 3.671.992 4.933 2.078 1.27 1.091 2.187 2.345 2.637 3.023a1.62 1.62 0 0 1 0 1.798c-.45.678-1.367 1.932-2.637 3.023C11.67 13.008 9.981 14 8 14c-1.981 0-3.671-.992-4.933-2.078C1.797 10.83.88 9.576.43 8.898a1.62 1.62 0 0 1 0-1.798c.45-.677 1.367-1.931 2.637-3.022C4.33 2.992 6.019 2 8 2ZM1.679 7.932a.12.12 0 0 0 0 .136c.411.622 1.241 1.75 2.366 2.717C5.176 11.758 6.527 12.5 8 12.5c1.473 0 2.825-.742 3.955-1.715 1.124-.967 1.954-2.096 2.366-2.717a.12.12 0 0 0 0-.136c-.412-.621-1.242-1.75-2.366-2.717C10.824 4.242 9.473 3.5 8 3.5c-1.473 0-2.825.742-3.955 1.715-1.124.967-1.954 2.096-2.366 2.717ZM8 10a2 2 0 1 1-.001-3.999A2 2 0 0 1 8 10Z"></path>
                </svg>
                <span id="watch-text">{% if is_watching %}Watching{% else %}Watch{% endif %}</span>
                <span class="repo-action-count" id="watch-count">{{ watch_count }}</span>
            </button>

            <!-- Star Button -->
            <button class="repo-action-btn{% if is_starred %} active{% endif %}" id="star-btn" onclick="handleStar(event)" data-username="{{ project.owner.username }}" data-slug="{{ project.slug }}">
                <svg class="repo-action-icon" viewBox="0 0 16 16" width="16" height="16">
                    {% if is_starred %}
                    <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Z" fill="currentColor"></path>
                    {% else %}
                    <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Z"></path>
                    {% endif %}
                </svg>
                <span id="star-text">{% if is_starred %}Starred{% else %}Star{% endif %}</span>
                <span class="repo-action-count" id="star-count">{{ star_count }}</span>
            </button>

            <!-- Fork Button -->
            <button class="repo-action-btn" id="fork-btn" onclick="handleFork(event)" data-username="{{ project.owner.username }}" data-slug="{{ project.slug }}">
                <svg class="repo-action-icon" viewBox="0 0 16 16" width="16" height="16">
                    <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
                </svg>
                <span>Fork</span>
                <span class="repo-action-count" id="fork-count">{{ fork_count }}</span>
            </button>
        </div>
    </div>
    {% if project.description %}
    <div class="repo-description">{{ project.description }}</div>
    {% endif %}
</div>
