{% extends 'global_base.html' %}
{% load static %}
{% block title %}
    Security
    Policy - {{ project.name }}
{% endblock %}
{% block extra_css %}
    <link rel="stylesheet"
          href="{% static 'project_app/css/project_app.css' %}" />
    <link rel="stylesheet"
          href="{% static 'project_app/css/shared/buttons.css' %}" />
{% endblock %}
{% block content %}
    <div class="container-fluid" style="max-width: 1280px">
        {% include 'project_app/repository/browse_partials/browse_header.html' %}
        {% include 'project_app/repository/browse_partials/browse_tabs.html' with active_tab='security' %}
        {% include 'project_app/security_overview_partials/security_overview_tabs.html' with active_tab='policy' %}
        <h2 class="mb-3">Security Policy</h2>
        {% if project.can_edit user %}
            <form method="post">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="content" class="form-label">Policy Content (Markdown)</label>
                    <textarea name="content" id="content" class="form-control" rows="20" style="font-family: monospace">
{{ policy.content }}</textarea>
                    <small class="form-text text-muted">This will be saved to SECURITY.md in your repository</small>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="contact_email" class="form-label">Contact Email</label>
                        <input type="email"
                               name="contact_email"
                               id="contact_email"
                               class="form-control"
                               value="{{ policy.contact_email }}" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="contact_url" class="form-label">Contact URL</label>
                        <input type="url"
                               name="contact_url"
                               id="contact_url"
                               class="form-control"
                               value="{{ policy.contact_url }}" />
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Save Security Policy</button>
            </form>
        {% else %}
            <div class="card">
                <div class="card-body">
                    <div class="markdown-body">{{ policy.content|linebreaks }}</div>
                    {% if policy.contact_email %}
                        <hr />
                        <p>
                            <strong>Contact:</strong>
                            <a href="mailto:{{ policy.contact_email }}">{{ policy.contact_email }}</a>
                        </p>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}
