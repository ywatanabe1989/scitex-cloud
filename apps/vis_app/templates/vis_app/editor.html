{% extends "global_base.html" %}
{% load static %}

{% block title %}SciTeX Vis{% if current_project %} - {{ current_project.name }}{% endif %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'shared/css/components/workspace-files-tree.css' %}">
<!-- Sigma Editor CSS Modules (refactored from monolithic sigma.css) -->
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/variables.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/layout.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/ribbon.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/sidebar.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/workspace.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/properties-panel.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/status-bar.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/theme.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/split-view.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/data-table.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/controls.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/drag-drop.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/editable-table.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/resize-handles.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/tree.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/sigma/scrollbars.css' %}">
<link rel="stylesheet" href="{% static 'vis_app/css/editor-inline.css' %}">
{% endblock %}

{% block content %}
<div class="sigma-editor-container"{% if current_project %} data-project-owner="{{ current_project.owner.username }}" data-project-slug="{{ current_project.slug }}"{% endif %}>


    <!-- ========================================================================
         MAIN CONTENT AREA
         ======================================================================== -->
    <div class="sigma-main">
        <!-- LEFT SIDEBAR - PROJECT NAVIGATOR -->
        <div class="sigma-sidebar">
            <div class="sidebar-header">
                <h4>
                    <i class="fas fa-folder-open"></i>
                </h4>
                <button class="sidebar-toggle-btn" id="sidebar-toggle">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            <div class="sidebar-content" id="files-tree">
                {% if current_project %}
                <!-- WorkspaceFilesTree will render here -->
                <div class="wft-loading">Loading...</div>
                {% else %}
                <div class="tree-empty-state">
                    <i class="fas fa-folder-open"></i>
                    <p>Select a project to view files</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Sidebar Resizer -->
        <div class="panel-resizer" id="sidebar-resizer"></div>

        <!-- CENTER WORKSPACE -->
        <div class="sigma-workspace">
            <!-- Split View: Data Table + Canvas -->
            <div class="workspace-split-view">
                <!-- Left: Data Table -->
                <div class="split-pane split-pane-left" id="data-pane">
                    <div class="pane-header">
                        <h5><i class="fas fa-table"></i></h5>
                        <div class="pane-header-buttons">
                            <button class="pane-header-btn" id="import-data-btn-small" title="Import data file (CSV, Excel) - Click to select or drag & drop">
                                <i class="fas fa-file-import"></i>
                            </button>
                            <button class="pane-header-btn" id="demo-data-btn-small" title="Load sample data for testing">
                                <i class="fas fa-flask"></i>
                            </button>
                            <button class="pane-header-btn" id="export-plot-csv-btn" title="Export current plot data as CSV">
                                <i class="fas fa-file-export"></i>
                            </button>
                            <button class="pane-header-btn active" id="header-toggle-btn" title="Toggle first row as header - When ON, first row of imported CSV/Excel files becomes column headers">
                                <i class="fas fa-heading"></i>
                            </button>
                            <button class="pane-header-btn" id="index-toggle-btn" title="Toggle first column as index - When ON, first column becomes row index (like pandas DataFrame)">
                                <i class="fas fa-hashtag"></i>
                            </button>
                            <button class="pane-header-btn" id="transform-sort" title="Sort data">
                                <i class="fas fa-sort"></i>
                            </button>
                            <button class="pane-header-btn" id="transform-filter" title="Filter data">
                                <i class="fas fa-filter"></i>
                            </button>
                            <button class="pane-header-btn" id="add-columns-btn" title="Add 10 more columns">
                                <i class="fas fa-columns"></i>
                                <span>+10</span>
                            </button>
                            <button class="pane-header-btn" id="add-rows-btn" title="Add 10 more rows">
                                <i class="fas fa-grip-lines"></i>
                                <span>+10</span>
                            </button>
                            <button class="pane-header-btn" id="table-help-btn" title="Show keyboard shortcuts and usage tips">
                                <i class="fas fa-question-circle"></i>
                            </button>
                        </div>
                        <button class="pane-resize-btn" id="data-pane-toggle" title="Toggle Data Pane">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                    </div>
                    <div class="pane-content">
                        <div class="data-table-container" id="data-table-container">
                            <div class="empty-state" id="data-empty-state">
                                <i class="fas fa-table"></i>
                                <p>No data loaded</p>
                                <small>Import CSV or Excel, or drag & drop files here</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resizer -->
                <div class="split-resizer" id="split-resizer"></div>

                <!-- Right: Canvas -->
                <div class="split-pane split-pane-right" id="canvas-pane">
                    <div class="pane-header">
                        <h5><i class="fas fa-paint-brush"></i></h5>
                        <div class="pane-header-buttons">
                            <!-- Quick Create Plot Buttons -->
                            <button class="pane-header-btn" data-plot-type="scatter" title="Create scatter plot">
                                <i class="fas fa-braille"></i>
                            </button>
                            <button class="pane-header-btn" data-plot-type="line" title="Create line plot">
                                <i class="fas fa-chart-line"></i>
                            </button>
                            <button class="pane-header-btn" data-plot-type="bar" title="Create bar chart">
                                <i class="fas fa-chart-bar"></i>
                            </button>
                            <button class="pane-header-btn" data-plot-type="histogram" title="Create histogram">
                                <i class="fas fa-chart-column"></i>
                            </button>
                            <button class="pane-header-btn" data-plot-type="box" title="Create box plot">
                                <i class="fas fa-box"></i>
                            </button>
                            <button class="pane-header-btn" data-plot-type="3d" title="Create 3D plot">
                                <i class="fas fa-project-diagram"></i>
                            </button>
                            <button class="pane-header-btn" data-plot-type="contour" title="Create contour plot">
                                <i class="fas fa-chart-area"></i>
                            </button>
                            <button class="pane-header-btn" data-plot-type="heatmap" title="Create heatmap">
                                <i class="fas fa-fire"></i>
                            </button>
                            <!-- Export Buttons -->
                            <button class="pane-header-btn" id="export-png" title="Export as PNG">
                                <i class="fas fa-file-image"></i>
                            </button>
                            <button class="pane-header-btn" id="export-pdf" title="Export as PDF">
                                <i class="fas fa-file-pdf"></i>
                            </button>
                            <button class="pane-header-btn" id="export-svg" title="Export as SVG">
                                <i class="fas fa-file-code"></i>
                            </button>
                            <button class="pane-header-btn" id="btn-save" title="Save plot">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </button>
                            <button class="pane-header-btn" id="btn-share" title="Share plot">
                                <i class="fas fa-share-alt"></i>
                            </button>
                            <!-- Theme Toggle Button -->
                            <button class="pane-header-btn" id="canvas-theme-toggle" title="Toggle light/dark theme">ðŸŒ“</button>
                            <!-- Ruler Unit Toggle Button -->
                            <button class="pane-header-btn" id="ruler-unit-toggle" title="Toggle ruler units (mm/inch)">
                                <span id="ruler-unit-label">mm</span>
                            </button>
                        </div>
                    </div>
                    <div class="pane-content canvas-content">
                        <!-- Rulers Area: 3x3 CSS Grid layout (like vis app) -->
                        <div class="sigma-rulers-area" id="rulers-area">
                            <!-- Top-left corner -->
                            <div class="ruler-corner ruler-corner-tl"></div>
                            <!-- Top ruler -->
                            <svg class="ruler ruler-horizontal ruler-top" id="ruler-h"></svg>
                            <!-- Top-right corner -->
                            <div class="ruler-corner ruler-corner-tr"></div>
                            
                            <!-- Left ruler -->
                            <svg class="ruler ruler-vertical ruler-left" id="ruler-v"></svg>
                            <!-- Canvas container -->
                            <div class="sigma-canvas-container" id="canvas-container">
                                <canvas id="sigma-canvas"></canvas>
                            </div>
                            <!-- Right ruler -->
                            <svg class="ruler ruler-vertical ruler-right" id="ruler-r"></svg>

                            <!-- Bottom-left corner -->
                            <div class="ruler-corner ruler-corner-bl"></div>
                            <!-- Bottom ruler -->
                            <svg class="ruler ruler-horizontal ruler-bottom" id="ruler-b"></svg>
                            <!-- Bottom-right corner -->
                            <div class="ruler-corner ruler-corner-br"></div>
                        </div>
                        <!-- Dark Mode Warning at Bottom -->
                        <div class="canvas-mode-warning" id="canvas-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Export will use white background for publication</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Workspace Resizer -->
        <div class="panel-resizer" id="workspace-resizer"></div>

        <!-- RIGHT PROPERTIES PANEL (æ”¹å–„ 3: Tabbed) -->
        <div class="sigma-properties">
            <div class="properties-header">
                <h4>
                    <i class="fas fa-sliders-h"></i>
                </h4>
                <div class="pane-header-buttons">
                    <!-- Journal Presets -->
                    <button class="pane-header-btn preset-btn" data-preset="SCITEX_STYLE" title="Apply SciTeX style preset">
                        <i class="fas fa-star"></i>
                    </button>
                    <button class="pane-header-btn preset-btn" data-preset="NATURE" title="Apply Nature style preset">
                        <i class="fas fa-book"></i>
                    </button>
                    <button class="pane-header-btn preset-btn" data-preset="SCIENCE" title="Apply Science style preset">
                        <i class="fas fa-flask"></i>
                    </button>
                    <button class="pane-header-btn preset-btn" data-preset="CELL" title="Apply Cell style preset">
                        <i class="fas fa-microscope"></i>
                    </button>
                    <!-- Customization -->
                    <button class="pane-header-btn" id="customize-font" title="Customize font settings">
                        <i class="fas fa-font"></i>
                    </button>
                    <button class="pane-header-btn" id="customize-colors" title="Customize colors">
                        <i class="fas fa-palette"></i>
                    </button>
                    <button class="pane-header-btn" id="customize-size" title="Customize size settings">
                        <i class="fas fa-ruler"></i>
                    </button>
                </div>
                <button class="properties-toggle-btn" id="properties-toggle">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <!-- Selected Item Info -->
            <div class="selected-item-info">
                <div class="selected-item-header">
                    <i class="fas fa-info-circle selected-item-icon"></i>
                    <span class="selected-item-type">No selection</span>
                </div>
                <div class="selected-item-label">Select an item from the tree to view properties</div>
            </div>

            <div class="properties-content">
                <!-- Dynamic Properties Panel -->
                <div id="dynamic-properties" class="dynamic-properties">
                    <!-- Content will be dynamically populated based on selection -->

                    <!-- Figure Properties Template (hidden) -->
                    <template id="template-figure-props">
                        <div class="property-group">
                            <label class="property-label">Label</label>
                            <input type="text" class="property-input" id="prop-figure-label" placeholder="Figure label">
                        </div>
                        <div class="property-group">
                            <label class="property-label">Width (inches)</label>
                            <input type="number" class="property-input" id="prop-figure-width" value="8" step="0.5">
                        </div>
                        <div class="property-group">
                            <label class="property-label">Height (inches)</label>
                            <input type="number" class="property-input" id="prop-figure-height" value="6" step="0.5">
                        </div>
                    </template>

                    <!-- Axis Properties Template (hidden) -->
                    <template id="template-axis-props">
                        <div class="property-group">
                            <label class="property-label">Label</label>
                            <input type="text" class="property-input" id="prop-axis-label" placeholder="Axis label">
                        </div>
                        <div class="property-group">
                            <label class="property-label">
                                <input type="checkbox" id="prop-axis-grid" checked> Show Grid
                            </label>
                        </div>
                        <div class="property-group">
                            <label class="property-label">
                                <input type="checkbox" id="prop-axis-log-x"> Log Scale X
                            </label>
                        </div>
                        <div class="property-group">
                            <label class="property-label">
                                <input type="checkbox" id="prop-axis-log-y"> Log Scale Y
                            </label>
                        </div>
                    </template>

                    <!-- Labels Properties Template (hidden) -->
                    <template id="template-labels-props">
                        <div class="property-group">
                            <label class="property-label">Title</label>
                            <input type="text" class="property-input" id="prop-labels-title" placeholder="Plot title">
                        </div>
                        <div class="property-group">
                            <label class="property-label">X Label</label>
                            <input type="text" class="property-input" id="prop-labels-x" placeholder="X-axis label">
                        </div>
                        <div class="property-group">
                            <label class="property-label">Y Label</label>
                            <input type="text" class="property-input" id="prop-labels-y" placeholder="Y-axis label">
                        </div>
                        <div class="property-group">
                            <label class="property-label">Font Size</label>
                            <input type="number" class="property-input" id="prop-labels-fontsize" value="12" min="6" max="24">
                        </div>
                    </template>

                    <!-- Plot Properties Template (hidden) -->
                    <template id="template-plot-props">
                        <div class="property-group">
                            <label class="property-label">Plot Type</label>
                            <select class="property-select" id="prop-plot-type">
                                <option value="line">Line</option>
                                <option value="scatter">Scatter</option>
                                <option value="bar">Bar</option>
                                <option value="histogram">Histogram</option>
                                <option value="box">Box</option>
                            </select>
                        </div>
                        <div class="property-group">
                            <label class="property-label">X-axis Column</label>
                            <select class="property-select" id="prop-x-column">
                                <option value="">-- Select --</option>
                            </select>
                        </div>
                        <div class="property-group">
                            <label class="property-label">Y-axis Column</label>
                            <select class="property-select" id="prop-y-column">
                                <option value="">-- Select --</option>
                            </select>
                        </div>
                        <div class="property-group">
                            <label class="property-label">Color</label>
                            <input type="color" class="property-color" id="prop-plot-color" value="#4a9b7e">
                        </div>
                        <div class="property-group">
                            <label class="property-label">Line Width</label>
                            <input type="range" class="property-range" id="prop-line-width" min="0.5" max="5" step="0.5" value="2">
                            <span class="property-value">2</span>
                        </div>
                        <div class="property-group">
                            <label class="property-label">Marker Size</label>
                            <input type="range" class="property-range" id="prop-marker-size" min="2" max="20" step="1" value="8">
                            <span class="property-value">8</span>
                        </div>
                    </template>

                    <!-- Guide (Legend/Colorbar) Properties Template (hidden) -->
                    <template id="template-guide-props">
                        <div class="property-group">
                            <label class="property-label">Guide Type</label>
                            <select class="property-select" id="prop-guide-type">
                                <option value="legend">Legend</option>
                                <option value="colorbar">Colorbar</option>
                            </select>
                        </div>
                        <div class="property-group" id="guide-legend-props">
                            <label class="property-label">
                                <input type="checkbox" id="prop-show-legend" checked> Show Legend
                            </label>
                            <label class="property-label">Position</label>
                            <select class="property-select" id="prop-legend-position">
                                <option value="top-right">Top Right</option>
                                <option value="top-left">Top Left</option>
                                <option value="bottom-right">Bottom Right</option>
                                <option value="bottom-left">Bottom Left</option>
                            </select>
                        </div>
                        <div class="property-group" id="guide-colorbar-props">
                            <label class="property-label">Orientation</label>
                            <select class="property-select" id="prop-colorbar-orientation">
                                <option value="vertical">Vertical</option>
                                <option value="horizontal">Horizontal</option>
                            </select>
                        </div>
                    </template>

                    <!-- Annotation Properties Template (hidden) -->
                    <template id="template-annotation-props">
                        <div class="property-group">
                            <label class="property-label">Annotation Type</label>
                            <select class="property-select" id="prop-annotation-type">
                                <option value="text">Text</option>
                                <option value="arrow">Arrow</option>
                                <option value="scalebar">Scale Bar</option>
                            </select>
                        </div>
                        <div class="property-group" id="annotation-text-props">
                            <label class="property-label">Text</label>
                            <input type="text" class="property-input" id="prop-annotation-text" placeholder="Annotation text">
                        </div>
                        <div class="property-group">
                            <label class="property-label">X Position</label>
                            <input type="number" class="property-input" id="prop-annotation-x" value="0" step="0.1">
                        </div>
                        <div class="property-group">
                            <label class="property-label">Y Position</label>
                            <input type="number" class="property-input" id="prop-annotation-y" value="0" step="0.1">
                        </div>
                        <div class="property-group">
                            <label class="property-label">Font Size</label>
                            <input type="number" class="property-input" id="prop-annotation-fontsize" value="12" min="6" max="24">
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================================================
         BOTTOM STATUS BAR
         ======================================================================== -->
    <div class="sigma-status-bar">
        <div class="status-left">
            <div class="status-item">
                <i class="fas fa-circle"></i>
                <span id="status-mode">Data View</span>
            </div>
        </div>
        <div class="status-center">
            <div class="status-item">
                <span id="status-message">Ready</span>
            </div>
        </div>
        <div class="status-right">
            <div class="status-item">
                <i class="fas fa-user"></i>
                <span>{{ request.user.username }}</span>
            </div>
        </div>
    </div>
</div>

<!-- Hidden file input for import -->
<input type="file" id="data-file-input" accept=".csv,.xlsx,.xls">

<!-- Customization Modals -->
<div id="font-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-font"></i> Font Settings</h3>
            <button class="modal-close" data-modal="font-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="font-family">Font Family</label>
                <select id="font-family" class="form-control">
                    <option value="Arial, sans-serif">Arial</option>
                    <option value="'Times New Roman', serif">Times New Roman</option>
                    <option value="'Courier New', monospace">Courier New</option>
                    <option value="Helvetica, sans-serif">Helvetica</option>
                    <option value="Georgia, serif">Georgia</option>
                </select>
            </div>
            <div class="form-group">
                <label for="font-size">Font Size (pt)</label>
                <input type="number" id="font-size" class="form-control" min="6" max="24" value="12">
            </div>
            <div class="form-group">
                <label for="title-font-size">Title Font Size (pt)</label>
                <input type="number" id="title-font-size" class="form-control" min="10" max="32" value="16">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-modal="font-modal">Cancel</button>
            <button class="btn btn-primary" id="apply-font">Apply</button>
        </div>
    </div>
</div>

<div id="colors-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-palette"></i> Color Settings</h3>
            <button class="modal-close" data-modal="colors-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="line-color">Line Color</label>
                <input type="color" id="line-color" class="form-control" value="#4a9b7e">
            </div>
            <div class="form-group">
                <label for="grid-color">Grid Color</label>
                <input type="color" id="grid-color" class="form-control" value="#e1e8ed">
            </div>
            <div class="form-group">
                <label for="bg-color">Background Color</label>
                <input type="color" id="bg-color" class="form-control" value="#ffffff">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-modal="colors-modal">Cancel</button>
            <button class="btn btn-primary" id="apply-colors">Apply</button>
        </div>
    </div>
</div>

<div id="size-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-ruler"></i> Size Settings</h3>
            <button class="modal-close" data-modal="size-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="plot-width">Width (px)</label>
                <input type="number" id="plot-width" class="form-control" min="400" max="2000" value="800" step="50">
            </div>
            <div class="form-group">
                <label for="plot-height">Height (px)</label>
                <input type="number" id="plot-height" class="form-control" min="300" max="1500" value="600" step="50">
            </div>
            <div class="form-group">
                <label for="line-width">Line Width (px)</label>
                <input type="number" id="line-width" class="form-control" min="0.5" max="10" value="2.5" step="0.5">
            </div>
            <div class="form-group">
                <label for="marker-size">Marker Size (px)</label>
                <input type="number" id="marker-size" class="form-control" min="2" max="20" value="8" step="1">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-modal="size-modal">Cancel</button>
            <button class="btn btn-primary" id="apply-size">Apply</button>
        </div>
    </div>
</div>

<!-- Transform Modals -->
<div id="sort-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-sort"></i> Sort Data</h3>
            <button class="modal-close" data-modal="sort-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="sort-column">Sort By Column</label>
                <select id="sort-column" class="form-control">
                    <!-- Options populated dynamically -->
                </select>
            </div>
            <div class="form-group">
                <label for="sort-order">Order</label>
                <select id="sort-order" class="form-control">
                    <option value="asc">Ascending</option>
                    <option value="desc">Descending</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-modal="sort-modal">Cancel</button>
            <button class="btn btn-primary" id="apply-sort">Sort</button>
        </div>
    </div>
</div>

<div id="filter-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-filter"></i> Filter Data</h3>
            <button class="modal-close" data-modal="filter-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="filter-column">Column</label>
                <select id="filter-column" class="form-control">
                    <!-- Options populated dynamically -->
                </select>
            </div>
            <div class="form-group">
                <label for="filter-operator">Operator</label>
                <select id="filter-operator" class="form-control">
                    <option value="eq">Equal to (=)</option>
                    <option value="ne">Not equal to (â‰ )</option>
                    <option value="gt">Greater than (>)</option>
                    <option value="gte">Greater than or equal (â‰¥)</option>
                    <option value="lt">Less than (<)</option>
                    <option value="lte">Less than or equal (â‰¤)</option>
                    <option value="contains">Contains</option>
                </select>
            </div>
            <div class="form-group">
                <label for="filter-value">Value</label>
                <input type="text" id="filter-value" class="form-control" placeholder="Enter value">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-modal="filter-modal">Cancel</button>
            <button class="btn btn-primary" id="apply-filter">Apply Filter</button>
        </div>
    </div>
</div>

<div id="compute-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-calculator"></i> Compute Column</h3>
            <button class="modal-close" data-modal="compute-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="compute-name">New Column Name</label>
                <input type="text" id="compute-name" class="form-control" placeholder="e.g., Sum_AB">
            </div>
            <div class="form-group">
                <label for="compute-operation">Operation</label>
                <select id="compute-operation" class="form-control">
                    <option value="add">Add: A + B</option>
                    <option value="subtract">Subtract: A - B</option>
                    <option value="multiply">Multiply: A Ã— B</option>
                    <option value="divide">Divide: A Ã· B</option>
                    <option value="sqrt">Square Root: âˆšA</option>
                    <option value="square">Square: AÂ²</option>
                    <option value="log">Natural Log: ln(A)</option>
                    <option value="abs">Absolute Value: |A|</option>
                </select>
            </div>
            <div class="form-group">
                <label for="compute-column-a">Column A</label>
                <select id="compute-column-a" class="form-control">
                    <!-- Options populated dynamically -->
                </select>
            </div>
            <div class="form-group" id="compute-column-b-group">
                <label for="compute-column-b">Column B</label>
                <select id="compute-column-b" class="form-control">
                    <!-- Options populated dynamically -->
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-modal="compute-modal">Cancel</button>
            <button class="btn btn-primary" id="apply-compute">Compute</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}

<!-- Fabric.js for canvas manipulation (like vis app) -->
<script type="module" src="{% static 'vis_app/ts/editor-inline.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
<script type="module" src="{% static 'vis_app/js/sigma-editor.js' %}"></script>
{% endblock %}
