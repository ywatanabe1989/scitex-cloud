    <!-- Sidebar -->
    <div class="writer-sidebar" id="writer-sidebar">
        <div class="sidebar-content">
            <!-- TeX Files Browser Section -->
            <div class="tex-files-browser">
                <div>
                    <h6>
                        <i class="fas fa-folder-tree me-2"></i>Project Files
                    </h6>
                    <button id="refresh-files-btn" class="btn btn-sm btn-outline-primary" title="Refresh file list">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>

                <!-- File tree container -->
                <div id="tex-files-list" class="tex-files-list">
                    <div class="text-muted" style="padding: 1rem 0.5rem;">
                        <i class="fas fa-info-circle me-2"></i>
                        <small>Create workspace to browse files</small>
                    </div>
                </div>
            </div>

            <!-- Collaborators Section -->
            {% if project %}
            <div class="collaborators-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h6 style="margin: 0;">
                        <i class="fas fa-users me-2"></i>Collaborators
                    </h6>
                    {% if project.owner == user %}
                    <a href="/{{ project.owner.username }}/{{ project.slug }}/settings/collaboration/"
                       class="btn btn-sm btn-outline-primary"
                       title="Manage collaborators"
                       style="padding: 2px 8px; font-size: 12px;">
                        <i class="fas fa-user-plus"></i>
                    </a>
                    {% endif %}
                </div>
                <div class="collaborators-list" style="max-height: 150px; overflow-y: auto;">
                    <!-- Owner -->
                    <div class="collaborator-item" style="padding: 6px 8px; display: flex; align-items: center; gap: 8px; border-bottom: 1px solid var(--color-border-muted);">
                        <div class="collaborator-avatar" style="width: 24px; height: 24px; border-radius: 50%; background: var(--color-accent-emphasis); color: white; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600;">
                            {{ project.owner.username|slice:":1"|upper }}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 13px; font-weight: 500;">{{ project.owner.username }}</div>
                            <div style="font-size: 11px; color: var(--color-fg-muted);">Owner</div>
                        </div>
                    </div>

                    <!-- Collaborators -->
                    {% for membership in project.memberships.all %}
                        {% if membership.user != project.owner %}
                        <div class="collaborator-item" style="padding: 6px 8px; display: flex; align-items: center; gap: 8px; border-bottom: 1px solid var(--color-border-muted);">
                            <div class="collaborator-avatar" style="width: 24px; height: 24px; border-radius: 50%; background: #6366f1; color: white; display: flex; align-items: center; justify-center; font-size: 11px; font-weight: 600;">
                                {{ membership.user.username|slice:":1"|upper }}
                            </div>
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-size: 13px; font-weight: 500;">{{ membership.user.username }}</div>
                                <div style="font-size: 11px; color: var(--color-fg-muted);">{{ membership.get_role_display }}</div>
                            </div>
                        </div>
                        {% endif %}
                    {% endfor %}

                    {% if project.memberships.count == 0 or project.memberships.count == 1 and project.memberships.first.user == project.owner %}
                    <div style="padding: 12px 8px; text-align: center; color: var(--color-fg-muted); font-size: 12px;">
                        <i class="fas fa-info-circle me-1"></i>No collaborators yet
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Version History Timeline -->
            <div class="history-timeline-section">
                <h6>
                    <i class="fas fa-history me-2"></i>History
                </h6>
                <div id="history-timeline-container">
                    <!-- History timeline will be rendered here -->
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <!-- Initialize Workspace Button (shown only when not initialized) -->
                <button id="init-writer-btn" class="btn btn-success w-100" style="display: {% if writer_initialized %}none{% else %}block{% endif %};">
                    <i class="fas fa-rocket me-2"></i>Create Workspace
                </button>

                <!-- Export Button -->
                <button id="export-btn" class="btn btn-outline-secondary w-100">
                    <i class="fas fa-download me-2"></i>Export
                </button>
            </div>
        </div>
    </div>

    <!-- Floating Section Panel (Initially Hidden) -->
    <div class="floating-section-panel" id="floating-section-panel" style="display: none;">
        <div class="floating-panel-header">
            <h6 class="mb-0">
                <i class="fas fa-list me-2"></i><span id="sections-title">Active Sections</span>
            </h6>
            <div>
                <button id="manage-sections-btn" class="btn btn-sm btn-outline-primary me-2" title="Add/Remove Sections">
                    <i class="fas fa-plus"></i>
                </button>
                <button id="close-section-panel" class="btn btn-sm btn-outline-secondary" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="floating-panel-content">
            <div class="section-list">
                <!-- Active sections will be dynamically generated -->
                <div class="section-items"></div>

                <!-- Available sections pool (initially hidden) -->
                <div id="section-pool" class="section-pool mt-3" style="display: none;">
                    <hr>
                    <h6 class="text-muted mb-2" style="font-size: 0.85rem;">
                        <i class="fas fa-layer-group me-1"></i>Available Sections
                    </h6>
                    <div id="available-sections" class="available-sections"></div>
                </div>
            </div>
        </div>
    </div>
