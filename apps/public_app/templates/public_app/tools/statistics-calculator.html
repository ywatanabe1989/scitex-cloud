{% extends "global_base.html" %}
{% block title %}
    Statistics Calculator -
    Browser Tool | SciTeX
{% endblock %}
{% block meta_description %}
    Calculate descriptive statistics, t-tests, correlations, and more. Perfect for quick data analysis.
{% endblock %}
{% block head_extra %}
    {% load static %}
    <link rel="icon"
          type="image/png"
          sizes="192x192"
          href="{% static 'images/vectorstock_38853699/vectorstock_38853699-navy-inverted-192x192.png' %}?v=3" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.9.6/jstat.min.js"></script>
{% endblock %}
{% block extra_css %}
    <style>
  .tool-detail-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
  }

  .tool-header {
    text-align: center;
    padding: 40px 20px;
    margin-bottom: 40px;
  }

  .tool-title {
    font-size: 42px;
    font-weight: 700;
    margin-bottom: 16px;
  }

  .tool-breadcrumb {
    font-size: 14px;
    margin-bottom: 16px;
  }

  .tool-breadcrumb a {
    color: #4a9b7e;
    text-decoration: none;
  }

  .tool-app-container {
    background: var(--bg-secondary);
    border-radius: 12px;
    padding: 40px;
    margin-bottom: 40px;
  }

  .test-selector {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 30px;
  }

  .test-btn {
    padding: 10px 20px;
    background: var(--bg-tertiary);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.2s;
  }

  .test-btn:hover {
    border-color: #4a9b7e;
  }

  .test-btn.active {
    background: #4a9b7e;
    color: white;
    border-color: #4a9b7e;
  }

  .data-input-section {
    margin-bottom: 30px;
  }

  .data-label {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 8px;
  }

  .data-textarea {
    width: 100%;
    min-height: 100px;
    padding: 12px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    resize: vertical;
  }

  .data-hint {
    font-size: 12px;
    color: var(--text-secondary);
    margin-top: 5px;
  }

  .results-section {
    background: var(--bg-primary);
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
  }

  .result-table {
    width: 100%;
    border-collapse: collapse;
  }

  .result-table th, .result-table td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
  }

  .result-table th {
    font-weight: 600;
    background: var(--bg-tertiary);
  }

  .result-value {
    font-family: 'Courier New', monospace;
    color: #4a9b7e;
    font-weight: 600;
  }

  .btn {
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
  }

  .btn-primary {
    background: #4a9b7e;
    color: white;
  }

  .btn-primary:hover:not(:disabled) {
    background: #3a7c65;
  }

  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
    </style>
{% endblock %}
{% block content %}
    <div class="tool-detail-container">
        <div class="tool-breadcrumb">
            <a href="{% url 'public_app:tools' %}">‚Üê Back to Tools</a>
        </div>
        <div class="tool-header">
            <div style="font-size: 64px; margin-bottom: 20px;">üìä</div>
            <h1 class="tool-title">Statistics Calculator</h1>
            <p style="font-size: 18px; color: var(--text-secondary);">
                Quick statistical analysis for research data
            </p>
        </div>
        <div class="tool-app-container">
            <div class="test-selector">
                <button class="test-btn active" data-test="descriptive">Descriptive Stats</button>
                <button class="test-btn" data-test="ttest">T-Test</button>
                <button class="test-btn" data-test="correlation">Correlation</button>
            </div>
            <div class="data-input-section">
                <div id="singleDataSection">
                    <div class="data-label">Data (one value per line or comma-separated)</div>
                    <textarea id="dataInput1" class="data-textarea" placeholder="12.5, 15.3, 14.2, 16.8
11.9, 13.4, 15.0"></textarea>
                    <div class="data-hint">Enter your data values separated by commas or newlines</div>
                </div>
                <div id="pairedDataSection" style="display: none;">
                    <div style="margin-bottom: 20px;">
                        <div class="data-label">Group 1 Data</div>
                        <textarea id="dataInput2" class="data-textarea" placeholder="12.5, 15.3, 14.2, 16.8"></textarea>
                    </div>
                    <div>
                        <div class="data-label">Group 2 Data</div>
                        <textarea id="dataInput3" class="data-textarea" placeholder="11.9, 13.4, 15.0, 12.7"></textarea>
                    </div>
                    <div class="data-hint">Enter data for both groups to compare</div>
                </div>
            </div>
            <button id="calculateBtn" class="btn btn-primary">üìà Calculate</button>
            <div id="resultsSection" class="results-section" style="display: none;">
                <h3 style="margin-top: 0; margin-bottom: 15px;">Results</h3>
                <div id="resultsContent"></div>
            </div>
        </div>
    </div>
    <script>
  let currentTest = 'descriptive';

  const testButtons = document.querySelectorAll('.test-btn');
  const singleDataSection = document.getElementById('singleDataSection');
  const pairedDataSection = document.getElementById('pairedDataSection');
  const calculateBtn = document.getElementById('calculateBtn');
  const resultsSection = document.getElementById('resultsSection');
  const resultsContent = document.getElementById('resultsContent');
  const dataInput1 = document.getElementById('dataInput1');
  const dataInput2 = document.getElementById('dataInput2');
  const dataInput3 = document.getElementById('dataInput3');

  testButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      testButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentTest = btn.dataset.test;

      if (currentTest === 'descriptive') {
        singleDataSection.style.display = 'block';
        pairedDataSection.style.display = 'none';
      } else {
        singleDataSection.style.display = 'none';
        pairedDataSection.style.display = 'block';
      }

      resultsSection.style.display = 'none';
    });
  });

  calculateBtn.addEventListener('click', () => {
    if (currentTest === 'descriptive') {
      calculateDescriptive();
    } else if (currentTest === 'ttest') {
      calculateTTest();
    } else if (currentTest === 'correlation') {
      calculateCorrelation();
    }
  });

  function parseData(text) {
    return text.split(/[,\n\s]+/)
      .map(v => parseFloat(v.trim()))
      .filter(v => !isNaN(v));
  }

  function calculateDescriptive() {
    const data = parseData(dataInput1.value);

    if (data.length === 0) {
      alert('Please enter valid data');
      return;
    }

    const mean = jStat.mean(data);
    const median = jStat.median(data);
    const stdev = jStat.stdev(data, true);
    const sem = stdev / Math.sqrt(data.length);
    const ci95 = 1.96 * sem;
    const min = Math.min(...data);
    const max = Math.max(...data);

    resultsContent.innerHTML = `
      <table class="result-table">
        <tr><th>Statistic</th><th>Value</th></tr>
        <tr><td>N (sample size)</td><td class="result-value">${data.length}</td></tr>
        <tr><td>Mean</td><td class="result-value">${mean.toFixed(4)}</td></tr>
        <tr><td>Median</td><td class="result-value">${median.toFixed(4)}</td></tr>
        <tr><td>Std. Deviation</td><td class="result-value">${stdev.toFixed(4)}</td></tr>
        <tr><td>SEM (Std. Error)</td><td class="result-value">${sem.toFixed(4)}</td></tr>
        <tr><td>95% CI</td><td class="result-value">¬±${ci95.toFixed(4)}</td></tr>
        <tr><td>Min</td><td class="result-value">${min.toFixed(4)}</td></tr>
        <tr><td>Max</td><td class="result-value">${max.toFixed(4)}</td></tr>
      </table>
    `;

    resultsSection.style.display = 'block';
  }

  function calculateTTest() {
    const data1 = parseData(dataInput2.value);
    const data2 = parseData(dataInput3.value);

    if (data1.length === 0 || data2.length === 0) {
      alert('Please enter valid data for both groups');
      return;
    }

    const mean1 = jStat.mean(data1);
    const mean2 = jStat.mean(data2);
    const tstat = jStat.ttest(mean1, mean2, jStat.stdev(data1, true), jStat.stdev(data2, true), data1.length);
    const df = data1.length + data2.length - 2;
    const pvalue = 2 * (1 - jStat.studentt.cdf(Math.abs(tstat), df));

    resultsContent.innerHTML = `
      <table class="result-table">
        <tr><th>Statistic</th><th>Value</th></tr>
        <tr><td>Group 1 Mean</td><td class="result-value">${mean1.toFixed(4)}</td></tr>
        <tr><td>Group 2 Mean</td><td class="result-value">${mean2.toFixed(4)}</td></tr>
        <tr><td>Mean Difference</td><td class="result-value">${(mean1 - mean2).toFixed(4)}</td></tr>
        <tr><td>t-statistic</td><td class="result-value">${tstat.toFixed(4)}</td></tr>
        <tr><td>Degrees of Freedom</td><td class="result-value">${df}</td></tr>
        <tr><td>p-value (two-tailed)</td><td class="result-value">${pvalue.toFixed(6)}</td></tr>
        <tr><td>Significance</td><td class="result-value">${pvalue < 0.05 ? 'Significant (p < 0.05)' : 'Not significant (p ‚â• 0.05)'}</td></tr>
      </table>
    `;

    resultsSection.style.display = 'block';
  }

  function calculateCorrelation() {
    const data1 = parseData(dataInput2.value);
    const data2 = parseData(dataInput3.value);

    if (data1.length === 0 || data2.length === 0) {
      alert('Please enter valid data for both variables');
      return;
    }

    if (data1.length !== data2.length) {
      alert('Both variables must have the same number of data points');
      return;
    }

    const r = jStat.corrcoeff(data1, data2);
    const r2 = r * r;
    const n = data1.length;
    const t = r * Math.sqrt((n - 2) / (1 - r * r));
    const df = n - 2;
    const pvalue = 2 * (1 - jStat.studentt.cdf(Math.abs(t), df));

    resultsContent.innerHTML = `
      <table class="result-table">
        <tr><th>Statistic</th><th>Value</th></tr>
        <tr><td>Pearson's r</td><td class="result-value">${r.toFixed(4)}</td></tr>
        <tr><td>R¬≤ (coefficient of determination)</td><td class="result-value">${r2.toFixed(4)}</td></tr>
        <tr><td>N (sample size)</td><td class="result-value">${n}</td></tr>
        <tr><td>t-statistic</td><td class="result-value">${t.toFixed(4)}</td></tr>
        <tr><td>Degrees of Freedom</td><td class="result-value">${df}</td></tr>
        <tr><td>p-value</td><td class="result-value">${pvalue.toFixed(6)}</td></tr>
        <tr><td>Significance</td><td class="result-value">${pvalue < 0.05 ? 'Significant (p < 0.05)' : 'Not significant (p ‚â• 0.05)'}</td></tr>
        <tr><td>Interpretation</td><td class="result-value">${Math.abs(r) > 0.7 ? 'Strong' : Math.abs(r) > 0.4 ? 'Moderate' : 'Weak'} ${r > 0 ? 'positive' : 'negative'} correlation</td></tr>
      </table>
    `;

    resultsSection.style.display = 'block';
  }
    </script>
{% endblock %}
