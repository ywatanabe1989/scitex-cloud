{% extends "global_base.html" %}
{% block title %}Image Resizer - Browser Tool | SciTeX{% endblock %}
{% block meta_description %}Resize and crop images for journal submissions. Preset dimensions for common formats.{% endblock %}
{% block extra_css %}
    <style>
  .tool-detail-container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
  .tool-header { text-align: center; padding: 40px 20px; margin-bottom: 40px; }
  .tool-title { font-size: 42px; font-weight: 700; margin-bottom: 16px; }
  .tool-breadcrumb { font-size: 14px; margin-bottom: 16px; }
  .tool-breadcrumb a { color: #4a9b7e; text-decoration: none; }
  .tool-app-container { background: var(--bg-secondary); border-radius: 12px; padding: 40px; }
  .upload-zone { border: 3px dashed #4a9b7e; border-radius: 8px; padding: 60px 20px; text-align: center; cursor: pointer; background: var(--bg-primary); }
  .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
  .control-group { display: flex; flex-direction: column; gap: 8px; }
  .control-label { font-size: 14px; font-weight: 600; }
  .control-input, .control-select { padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; }
  .preview { text-align: center; margin: 20px 0; }
  .preview img { max-width: 100%; border: 1px solid var(--border-color); border-radius: 8px; }
  .btn { padding: 12px 24px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; border: none; }
  .btn-primary { background: #4a9b7e; color: white; }
  .btn-primary:hover:not(:disabled) { background: #3a7c65; }
    </style>
{% endblock %}
{% block content %}
    <div class="tool-detail-container">
        <div class="tool-breadcrumb"><a href="{% url 'public_app:tools' %}">‚Üê Back to Tools</a></div>
        <div class="tool-header">
            <div style="font-size: 64px; margin-bottom: 20px;">üìê</div>
            <h1 class="tool-title">Image Resizer</h1>
            <p style="font-size: 18px; color: var(--text-secondary);">Resize images for journal submissions</p>
        </div>
        <div class="tool-app-container">
            <div id="uploadZone" class="upload-zone">
                <div style="font-size: 48px; margin-bottom: 16px;">üì§</div>
                <div style="font-size: 18px;">Drop image or click to upload</div>
                <input type="file" id="fileInput" accept="image/*" style="display: none" />
            </div>
            <div class="controls" style="display: none;" id="controls">
                <div class="control-group">
                    <label class="control-label">Preset</label>
                    <select id="presetSelect" class="control-select">
                        <option value="custom">Custom</option>
                        <option value="1920x1080">Full HD (1920√ó1080)</option>
                        <option value="1280x720">HD (1280√ó720)</option>
                        <option value="800x600">Journal Fig (800√ó600)</option>
                        <option value="512x512">Square 512</option>
                    </select>
                </div>
                <div class="control-group">
                    <label class="control-label">Width (px)</label>
                    <input type="number" id="widthInput" class="control-input" value="800" />
                </div>
                <div class="control-group">
                    <label class="control-label">Height (px)</label>
                    <input type="number" id="heightInput" class="control-input" value="600" />
                </div>
                <div class="control-group">
                    <label class="control-label">Maintain Aspect Ratio</label>
                    <input type="checkbox" id="aspectCheck" checked style="width: 20px; height: 20px;" />
                </div>
            </div>
            <div class="preview" id="preview" style="display: none;">
                <h3>Preview</h3>
                <canvas id="canvas" style="max-width: 100%; border: 1px solid var(--border-color);"></canvas>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button id="downloadBtn" class="btn btn-primary" disabled>üíæ Download Resized Image</button>
            </div>
        </div>
    </div>
    <script>
  let originalImage = null;

  document.getElementById('uploadZone').addEventListener('click', () => document.getElementById('fileInput').click());
  document.getElementById('fileInput').addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      const img = new Image();
      img.onload = () => {
        originalImage = img;
        document.getElementById('controls').style.display = 'grid';
        document.getElementById('widthInput').value = img.width;
        document.getElementById('heightInput').value = img.height;
        updatePreview();
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  });

  document.getElementById('presetSelect').addEventListener('change', (e) => {
    if (e.target.value !== 'custom') {
      const [w, h] = e.target.value.split('x');
      document.getElementById('widthInput').value = w;
      document.getElementById('heightInput').value = h;
      updatePreview();
    }
  });

  document.getElementById('widthInput').addEventListener('input', () => {
    if (document.getElementById('aspectCheck').checked && originalImage) {
      const ratio = originalImage.height / originalImage.width;
      document.getElementById('heightInput').value = Math.round(document.getElementById('widthInput').value * ratio);
    }
    updatePreview();
  });

  document.getElementById('heightInput').addEventListener('input', () => {
    if (document.getElementById('aspectCheck').checked && originalImage) {
      const ratio = originalImage.width / originalImage.height;
      document.getElementById('widthInput').value = Math.round(document.getElementById('heightInput').value * ratio);
    }
    updatePreview();
  });

  function updatePreview() {
    if (!originalImage) return;

    const canvas = document.getElementById('canvas');
    const width = parseInt(document.getElementById('widthInput').value);
    const height = parseInt(document.getElementById('heightInput').value);

    canvas.width = width;
    canvas.height = height;

    const ctx = canvas.getContext('2d');
    ctx.drawImage(originalImage, 0, 0, width, height);

    document.getElementById('preview').style.display = 'block';
    document.getElementById('downloadBtn').disabled = false;
  }

  document.getElementById('downloadBtn').addEventListener('click', () => {
    const canvas = document.getElementById('canvas');
    canvas.toBlob((blob) => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `resized-${Date.now()}.png`;
      a.click();
      URL.revokeObjectURL(url);
    });
  });
    </script>
{% endblock %}
