{% extends "global_base.html" %}
{% block title %}
    Plot Viewer - Browser Tool | SciTeX
{% endblock %}
{% block meta_description %}
    Interactive plot viewer for SciTeX matplotlib exports. Upload CSV files and view them with publication-quality rendering.
{% endblock %}
{% block head_extra %}
    {% load static %}
    <link rel="icon"
          type="image/png"
          sizes="192x192"
          href="{% static 'images/vectorstock_38853699/vectorstock_38853699-navy-inverted-192x192.png' %}?v=3" />
{% endblock %}
{% block extra_css %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'public_app/css/tools/plot-viewer.css' %}">
{% endblock %}
{% block content %}
    <div class="tool-detail-container">
        <!-- Header -->
        <div class="tool-header">
            <div class="tool-breadcrumb">
                <a href="{% url 'public_app:tools' %}">Tools</a> / Plot Viewer
            </div>
            <h1 class="tool-title">Quick CSV Plot Viewer</h1>
            <p class="tool-subtitle">
                Interactive preview for simple CSV plots with <strong>Nature journal standards</strong>
            </p>
            <p style="font-size: 13px; color: var(--text-secondary); margin-top: 10px;">
                ✓ Supported: line, scatter, bar plots &nbsp;|&nbsp;
                ✓ Real-time parameter adjustment &nbsp;|&nbsp;
                ✓ Nature journal specifications &nbsp;|&nbsp;
                ✓ 300 DPI export
            </p>
            <p style="font-size: 12px; color: var(--text-tertiary); margin-top: 8px; font-style: italic;">
                Note: For advanced plot types (violin, heatmap, KDE, etc.), use the backend Plot API.
            </p>
        </div>
        <!-- Upload Section -->
        <div class="upload-section" id="uploadSection">
            <h3>Upload CSV File</h3>
            <p style="margin-bottom: 20px;">
                Drag and drop or click to select a CSV file exported from <code>scitex.plt</code>
            </p>
            <input type="file" id="csvFileInput" class="upload-input" accept=".csv">
            <button class="upload-button" onclick="document.getElementById('csvFileInput').click()">
                Select CSV File
            </button>
            <a href="#"
               class="example-link"
               onclick="loadDemoData(); return false;">or try with demo data</a>
        </div>
        <!-- Settings Toggle Button -->
        <button class="toggle-settings" id="toggleSettings" onclick="toggleSettingsPanel()">
            ⚙️ Adjust Figure Settings
        </button>
        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h3>Figure Settings (Nature Journal Standards)</h3>
                <button class="reset-button" onclick="resetToNatureDefaults()">Reset to Defaults</button>
            </div>
            <table class="settings-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Slider</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Figure Dimensions -->
                    <tr class="settings-category">
                        <td colspan="3">Figure Dimensions</td>
                    </tr>
                    <tr>
                        <td class="setting-label-cell">Width</td>
                        <td class="setting-slider-cell">
                            <input type="range" class="setting-input" id="figureWidth"
                                   min="20" max="80" step="1" value="35"
                                   oninput="updateSetting('width', this.value)">
                        </td>
                        <td class="setting-value-cell" id="widthValue">35.0 mm</td>
                    </tr>
                    <tr>
                        <td class="setting-label-cell">Height <span class="setting-note">(auto: 0.7 × Width)</span></td>
                        <td class="setting-slider-cell">
                            <input type="range" class="setting-input" id="figureHeight"
                                   min="14" max="56" step="0.1" value="24.5" disabled>
                        </td>
                        <td class="setting-value-cell" id="heightValue">24.5 mm</td>
                    </tr>

                    <!-- Line Properties -->
                    <tr class="settings-category">
                        <td colspan="3">Line Properties</td>
                    </tr>
                    <tr>
                        <td class="setting-label-cell">Line Width</td>
                        <td class="setting-slider-cell">
                            <input type="range" class="setting-input" id="lineWidth"
                                   min="0.05" max="0.5" step="0.01" value="0.12"
                                   oninput="updateSetting('lineWidth', this.value)">
                        </td>
                        <td class="setting-value-cell" id="lineWidthValue">0.12 mm</td>
                    </tr>
                    <tr>
                        <td class="setting-label-cell">Tick Length</td>
                        <td class="setting-slider-cell">
                            <input type="range" class="setting-input" id="tickLength"
                                   min="0.2" max="2.0" step="0.1" value="0.8"
                                   oninput="updateSetting('tickLength', this.value)">
                        </td>
                        <td class="setting-value-cell" id="tickLengthValue">0.8 mm</td>
                    </tr>
                    <tr>
                        <td class="setting-label-cell">Tick Thickness</td>
                        <td class="setting-slider-cell">
                            <input type="range" class="setting-input" id="tickWidth"
                                   min="0.05" max="0.5" step="0.05" value="0.2"
                                   oninput="updateSetting('tickWidth', this.value)">
                        </td>
                        <td class="setting-value-cell" id="tickWidthValue">0.20 mm</td>
                    </tr>
                    <tr>
                        <td class="setting-label-cell">Axis Thickness</td>
                        <td class="setting-slider-cell">
                            <input type="range" class="setting-input" id="axisWidth"
                                   min="0.05" max="0.5" step="0.05" value="0.2"
                                   oninput="updateSetting('axisWidth', this.value)">
                        </td>
                        <td class="setting-value-cell" id="axisWidthValue">0.20 mm</td>
                    </tr>

                    <!-- Font Sizes -->
                    <tr class="settings-category">
                        <td colspan="3">Font Sizes</td>
                    </tr>
                    <tr>
                        <td class="setting-label-cell">Title Font</td>
                        <td class="setting-slider-cell">
                            <input type="range" class="setting-input" id="titleFont"
                                   min="6" max="14" step="1" value="8"
                                   oninput="updateSetting('titleFont', this.value)">
                        </td>
                        <td class="setting-value-cell" id="titleFontValue">8 pt</td>
                    </tr>
                    <tr>
                        <td class="setting-label-cell">Axis Font</td>
                        <td class="setting-slider-cell">
                            <input type="range" class="setting-input" id="axisFont"
                                   min="6" max="14" step="1" value="8"
                                   oninput="updateSetting('axisFont', this.value)">
                        </td>
                        <td class="setting-value-cell" id="axisFontValue">8 pt</td>
                    </tr>
                    <tr>
                        <td class="setting-label-cell">Tick Font</td>
                        <td class="setting-slider-cell">
                            <input type="range" class="setting-input" id="tickFont"
                                   min="5" max="12" step="1" value="7"
                                   oninput="updateSetting('tickFont', this.value)">
                        </td>
                        <td class="setting-value-cell" id="tickFontValue">7 pt</td>
                    </tr>

                    <!-- Other Settings -->
                    <tr class="settings-category">
                        <td colspan="3">Other Settings</td>
                    </tr>
                    <tr>
                        <td class="setting-label-cell">Marker Size</td>
                        <td class="setting-slider-cell">
                            <input type="range" class="setting-input" id="markerSize"
                                   min="0.3" max="2.0" step="0.1" value="0.8"
                                   oninput="updateSetting('markerSize', this.value)">
                        </td>
                        <td class="setting-value-cell" id="markerSizeValue">0.8 mm</td>
                    </tr>
                    <tr>
                        <td class="setting-label-cell">Number of Ticks</td>
                        <td class="setting-slider-cell">
                            <input type="range" class="setting-input" id="numTicks"
                                   min="2" max="6" step="1" value="4"
                                   oninput="updateSetting('numTicks', this.value)">
                        </td>
                        <td class="setting-value-cell" id="numTicksValue">4</td>
                    </tr>

                    <!-- Axis Labels -->
                    <tr class="settings-category">
                        <td colspan="3">Axis Labels</td>
                    </tr>
                    <tr>
                        <td class="setting-label-cell">X-axis Label</td>
                        <td class="setting-slider-cell">
                            <input type="text" class="label-input" id="xLabel"
                                   value="X axis"
                                   oninput="updateSetting('xLabel', this.value)"
                                   style="width: 100%; padding: 6px; border: 1px solid var(--border-color);
                                          border-radius: 4px; background: var(--card-background);
                                          color: var(--text-primary); font-size: 13px;">
                        </td>
                        <td class="setting-value-cell" id="xLabelValue">X axis</td>
                    </tr>
                    <tr>
                        <td class="setting-label-cell">Y-axis Label</td>
                        <td class="setting-slider-cell">
                            <input type="text" class="label-input" id="yLabel"
                                   value="Y axis"
                                   oninput="updateSetting('yLabel', this.value)"
                                   style="width: 100%; padding: 6px; border: 1px solid var(--border-color);
                                          border-radius: 4px; background: var(--card-background);
                                          color: var(--text-primary); font-size: 13px;">
                        </td>
                        <td class="setting-value-cell" id="yLabelValue">Y axis</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- Plot Info -->
        <div class="plot-info" id="plotInfo" style="display: none;">
            <h3>File Information</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Filename</div>
                    <div class="stat-value" id="filename" style="font-size: 16px;">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Data Points</div>
                    <div class="stat-value" id="dataPoints">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Columns</div>
                    <div class="stat-value" id="columnCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Detected Plots</div>
                    <div class="stat-value" id="plotCount">0</div>
                </div>
            </div>
            <h4 style="margin-top: 20px;">Detected Columns:</h4>
            <div class="column-list" id="columnList"></div>
        </div>
        <!-- Plot Container -->
        <div class="plot-container" id="plotContainer" style="display: none;">
            <canvas id="plotCanvas"></canvas>
            <div style="text-align: center;">
                <div class="size-indicator">
                    Figure size: 35mm × 35mm (Nature journal standard) | 300 DPI
                </div>
                <button class="download-button" onclick="downloadPlot()">Download PNG (300 DPI)</button>
            </div>
        </div>
    </div>
{% endblock %}
{% block extra_js %}
    {% load static %}
    <script type="module" src="{% static 'public_app/js/tools/plot-viewer/index.js' %}"></script>
{% endblock %}
