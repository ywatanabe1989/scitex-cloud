{% extends 'base.html' %}
{% load static %}

{% block title %}Welcome to SciTeX - Getting Started{% endblock %}

{% block extra_css %}
<style>
:root {
    --scitex-primary: #1a2332;
    --scitex-secondary: #34495e;
    --scitex-accent: #506b7a;
    --scitex-light: #f8f9fa;
    --scitex-white: #ffffff;
    --scitex-success: #28a745;
    --scitex-warning: #ffc107;
    --scitex-info: #17a2b8;
}

.onboarding-hero {
    background: linear-gradient(135deg, var(--scitex-primary) 0%, var(--scitex-secondary) 100%);
    color: var(--scitex-white);
    padding: 3rem 0;
    margin-bottom: 2rem;
}

.progress-circle {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: conic-gradient(var(--scitex-success) {{ progress.completion_percentage }}%, var(--scitex-light) 0%);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.progress-circle::before {
    content: '';
    position: absolute;
    width: 90px;
    height: 90px;
    border-radius: 50%;
    background: var(--scitex-white);
}

.progress-text {
    position: relative;
    z-index: 1;
    font-weight: bold;
    color: var(--scitex-primary);
    font-size: 1.2rem;
}

.step-card {
    border: none;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    height: 100%;
}

.step-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
}

.step-card.completed {
    border-left: 4px solid var(--scitex-success);
}

.step-card.current {
    border-left: 4px solid var(--scitex-info);
    background: linear-gradient(45deg, #f8f9fa 0%, #e9ecef 100%);
}

.achievement-badge {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--scitex-warning) 0%, #ffd700 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--scitex-white);
    font-size: 1.5rem;
    margin-bottom: 1rem;
}

.template-card {
    border: none;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.2s ease;
}

.template-card:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    transform: translateY(-2px);
}

.btn-onboarding {
    background: linear-gradient(135deg, var(--scitex-primary) 0%, var(--scitex-secondary) 100%);
    border: none;
    color: var(--scitex-white);
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.2s ease;
}

.btn-onboarding:hover {
    background: linear-gradient(135deg, var(--scitex-secondary) 0%, var(--scitex-accent) 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(26, 35, 50, 0.3);
    color: var(--scitex-white);
}

.stats-card {
    background: var(--scitex-white);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    text-align: center;
}

.stats-number {
    font-size: 2rem;
    font-weight: bold;
    color: var(--scitex-primary);
}

.onboarding-nav {
    background: var(--scitex-white);
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    margin-bottom: 2rem;
}
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="onboarding-hero">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-5 mb-3">
                    <i class="fas fa-rocket me-3"></i>Welcome to SciTeX!
                </h1>
                <p class="lead mb-4">Let's get you started on your research journey. Complete the steps below to unlock the full potential of our scientific research platform.</p>
                
                {% if not is_completed %}
                <div class="d-flex gap-3">
                    <a href="{% url 'onboarding:start' %}" class="btn btn-light btn-lg">
                        <i class="fas fa-play me-2"></i>Start Tutorial
                    </a>
                    {% if next_step_key %}
                    <a href="{% url 'onboarding:step' next_step_key %}" class="btn btn-outline-light btn-lg">
                        <i class="fas fa-arrow-right me-2"></i>Continue: {{ next_step_name }}
                    </a>
                    {% endif %}
                </div>
                {% else %}
                <div class="alert alert-success border-0 bg-white bg-opacity-25 text-white">
                    <i class="fas fa-check-circle me-2"></i>
                    Congratulations! You've completed the onboarding process. Welcome to the SciTeX community!
                </div>
                {% endif %}
            </div>
            <div class="col-lg-4 text-center">
                <div class="progress-circle mx-auto">
                    <div class="progress-text">{{ progress.completion_percentage }}%</div>
                </div>
                <p class="mt-3 mb-0">Onboarding Progress</p>
            </div>
        </div>
    </div>
</section>

<div class="container">
    <!-- Quick Stats -->
    <div class="row mb-5">
        <div class="col-md-3">
            <div class="stats-card">
                <div class="stats-number">{{ progress.completion_percentage }}%</div>
                <div class="text-muted">Progress</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <div class="stats-number">{{ progress.completed_steps|length }}</div>
                <div class="text-muted">Steps Completed</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <div class="stats-number">{{ total_projects }}</div>
                <div class="text-muted">Projects Created</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <div class="stats-number">{{ recent_achievements|length }}</div>
                <div class="text-muted">Achievements</div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Current Step -->
            {% if not is_completed and next_step_key %}
            <div class="card step-card current mb-4">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="me-3">
                            <i class="fas fa-arrow-right text-info fa-2x"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-1">Next Step: {{ next_step_name }}</h5>
                            <p class="text-muted mb-0">Continue your onboarding journey</p>
                        </div>
                    </div>
                    <a href="{% url 'onboarding:step' next_step_key %}" class="btn btn-onboarding">
                        <i class="fas fa-play me-2"></i>Continue
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- Quick Actions -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'scholar:index' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-search me-2"></i>Search Literature
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'writer_app:index' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-edit me-2"></i>Write Document
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'core_app:dashboard' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-folder me-2"></i>Create Project
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'collaboration:dashboard' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-users me-2"></i>Join Team
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sample Templates -->
            {% if templates %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-template me-2"></i>Sample Project Templates</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for template in templates %}
                        <div class="col-md-4 mb-3">
                            <div class="card template-card h-100">
                                <div class="card-body">
                                    <h6 class="card-title">{{ template.name }}</h6>
                                    <p class="card-text text-muted small">{{ template.description|truncatewords:15 }}</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="badge bg-light text-dark">{{ template.get_difficulty_level_display }}</span>
                                        <a href="{% url 'onboarding:create_sample_project' template.id %}" class="btn btn-sm btn-outline-primary">
                                            Use Template
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Module Tours -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-rocket me-2"></i>Quick Access</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <a href="/scholar/" class="btn btn-outline-secondary w-100">
                                <i class="fas fa-search me-2"></i>Start Searching
                            </a>
                        </div>
                        <div class="col-md-6 mb-2">
                            <a href="/writer/" class="btn btn-outline-secondary w-100">
                                <i class="fas fa-edit me-2"></i>Start Writing
                            </a>
                        </div>
                        <div class="col-md-6 mb-2">
                            <a href="/code/" class="btn btn-outline-secondary w-100">
                                <i class="fas fa-code me-2"></i>View Code Module
                            </a>
                        </div>
                        <div class="col-md-6 mb-2">
                            <a href="/viz/" class="btn btn-outline-secondary w-100">
                                <i class="fas fa-chart-bar me-2"></i>View Viz Module
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Recent Achievements -->
            {% if recent_achievements %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-trophy me-2"></i>Recent Achievements</h5>
                </div>
                <div class="card-body">
                    {% for achievement in recent_achievements %}
                    <div class="d-flex align-items-center mb-3">
                        <div class="achievement-badge me-3">
                            <i class="{{ achievement.icon }}"></i>
                        </div>
                        <div>
                            <h6 class="mb-1">{{ achievement.title }}</h6>
                            <p class="text-muted small mb-0">{{ achievement.description }}</p>
                            <small class="text-success">+{{ achievement.points }} points</small>
                        </div>
                    </div>
                    {% endfor %}
                    <a href="{% url 'onboarding:achievements' %}" class="btn btn-sm btn-outline-primary w-100 mt-2">
                        View All Achievements
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- Help & Support -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-question-circle me-2"></i>Need Help?</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'cloud_app:contact' %}" class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-envelope me-2"></i>Contact Support
                        </a>
                        <a href="#" class="btn btn-outline-secondary btn-sm" onclick="showHelpChat()">
                            <i class="fas fa-comments me-2"></i>Live Chat
                        </a>
                        <a href="{% url 'onboarding:preferences' %}" class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-cog me-2"></i>Tutorial Settings
                        </a>
                    </div>
                </div>
            </div>

            <!-- Progress Summary -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Your Progress</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Onboarding</span>
                            <span>{{ progress.completion_percentage }}%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" style="width: {{ progress.completion_percentage }}%"></div>
                        </div>
                    </div>
                    <div class="small text-muted">
                        <p><i class="fas fa-calendar me-1"></i>Started: {{ progress.started_at|date:"M d, Y" }}</p>
                        <p><i class="fas fa-clock me-1"></i>Sessions: {{ progress.session_count }}</p>
                        {% if progress.completed_at %}
                        <p class="text-success"><i class="fas fa-check me-1"></i>Completed: {{ progress.completed_at|date:"M d, Y" }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showHelpChat() {
    alert('Live chat feature coming soon! For now, please use the contact form.');
}

// Track page visit for analytics
fetch('{% url "onboarding:api_track_action" %}', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}'
    },
    body: JSON.stringify({
        action_type: 'page_visit',
        page: 'onboarding_dashboard',
        metadata: {
            progress_percentage: {{ progress.completion_percentage }},
            current_step: '{{ progress.current_step }}'
        }
    })
});
</script>
{% endblock %}