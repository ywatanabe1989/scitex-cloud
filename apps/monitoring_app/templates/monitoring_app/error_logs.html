{% extends 'base.html' %}
{% load static %}

{% block title %}Error Logs - SciTeX Monitoring{% endblock %}

{% block extra_css %}
<style>
:root {
    --scitex-color-01: #1a2332;
    --scitex-color-02: #34495e;
    --scitex-color-03: #506b7a;
    --scitex-color-07: #f0f4f8;
}

.error-logs-page {
    background: linear-gradient(135deg, var(--scitex-color-07) 0%, #fafbfc 50%, var(--scitex-color-07) 100%);
    min-height: 100vh;
    padding: 2rem 0;
}

.error-item {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 10px rgba(26, 35, 50, 0.1);
    border-left: 4px solid var(--severity-color);
}

.error-item.low { --severity-color: #28a745; }
.error-item.medium { --severity-color: #ffc107; }
.error-item.high { --severity-color: #fd7e14; }
.error-item.critical { --severity-color: #dc3545; }

.severity-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
}

.severity-low { background: #d4edda; color: #155724; }
.severity-medium { background: #fff3cd; color: #856404; }
.severity-high { background: #ffe8d1; color: #8b5928; }
.severity-critical { background: #f8d7da; color: #721c24; }

.stack-trace {
    background: #f8f9fa;
    border-radius: 4px;
    padding: 1rem;
    font-family: 'Monaco', 'Consolas', monospace;
    font-size: 0.85rem;
    white-space: pre-wrap;
    max-height: 200px;
    overflow-y: auto;
    margin-top: 1rem;
}
</style>
{% endblock %}

{% block content %}
<div class="error-logs-page">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1>Error Logs</h1>
                <p class="text-muted">Recent system errors and exceptions</p>
            </div>
            <a href="{% url 'monitoring_app:dashboard' %}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
        </div>

        {% if errors %}
            {% for error in errors %}
            <div class="error-item {{ error.severity }}">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <div>
                        <span class="severity-badge severity-{{ error.severity }}">{{ error.severity }}</span>
                        <strong class="ms-2">{{ error.error_type }}</strong>
                    </div>
                    <small class="text-muted">{{ error.timestamp|date:"M d, Y H:i" }}</small>
                </div>
                
                <p class="mb-2">{{ error.message }}</p>
                
                {% if error.endpoint %}
                <p class="text-muted mb-1">
                    <i class="fas fa-link"></i> <code>{{ error.endpoint }}</code>
                </p>
                {% endif %}
                
                {% if error.user %}
                <p class="text-muted mb-1">
                    <i class="fas fa-user"></i> {{ error.user.username }}
                </p>
                {% endif %}
                
                {% if error.ip_address %}
                <p class="text-muted mb-1">
                    <i class="fas fa-globe"></i> {{ error.ip_address }}
                </p>
                {% endif %}
                
                {% if error.stack_trace %}
                <details>
                    <summary class="btn btn-sm btn-outline-secondary mt-2">
                        <i class="fas fa-bug"></i> Stack Trace
                    </summary>
                    <div class="stack-trace">{{ error.stack_trace }}</div>
                </details>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <div class="text-center py-5">
                <i class="fas fa-check-circle text-success" style="font-size: 3rem;"></i>
                <h3 class="mt-3">No Recent Errors</h3>
                <p class="text-muted">The system is running smoothly!</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}