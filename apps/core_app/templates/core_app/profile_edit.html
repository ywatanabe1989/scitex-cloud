{% extends 'github_base.html' %}
{% load static %}

{% block title %}Settings - SciTeX Cloud{% endblock %}

{% block extra_css %}
<style>
.settings-page {
    max-width: 1280px;
    margin: 0 auto;
    padding: 32px 16px;
}

.settings-layout {
    display: grid;
    grid-template-columns: 296px 1fr;
    gap: 24px;
}

/* Settings Navigation */
.settings-nav {
    background: #161b22;
    border: 1px solid #21262d;
    border-radius: 6px;
    padding: 8px;
}

.settings-nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    color: #c9d1d9;
    text-decoration: none;
    border-radius: 6px;
    transition: all 0.2s ease;
    font-size: 14px;
}

.settings-nav-item:hover {
    background: #21262d;
    text-decoration: none;
}

.settings-nav-item.active {
    background: #21262d;
    font-weight: 600;
}

.settings-nav-item i {
    width: 20px;
    text-align: center;
    color: #8b949e;
}

/* Settings Content */
.settings-content {
    min-width: 0;
}

.settings-header {
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid #21262d;
}

.settings-title {
    font-size: 24px;
    font-weight: 600;
    color: #c9d1d9;
    margin-bottom: 4px;
}

.settings-subtitle {
    font-size: 14px;
    color: #8b949e;
}

/* Form Sections */
.form-section {
    background: #0d1117;
    border: 1px solid #21262d;
    border-radius: 6px;
    padding: 24px;
    margin-bottom: 24px;
}

.form-section-title {
    font-size: 16px;
    font-weight: 600;
    color: #c9d1d9;
    margin-bottom: 16px;
    padding-bottom: 8px;
    border-bottom: 1px solid #21262d;
}

.form-group {
    margin-bottom: 16px;
}

.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: #c9d1d9;
    margin-bottom: 8px;
}

.form-group input[type="text"],
.form-group input[type="email"],
.form-group input[type="url"],
.form-group textarea {
    width: 100%;
    background: #0d1117;
    border: 1px solid #30363d;
    border-radius: 6px;
    padding: 8px 12px;
    color: #c9d1d9;
    font-size: 14px;
    transition: all 0.2s ease;
    font-family: inherit;
}

.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #58a6ff;
    box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.form-help {
    font-size: 12px;
    color: #8b949e;
    margin-top: 4px;
}

/* Avatar Upload */
.avatar-upload {
    display: flex;
    align-items: start;
    gap: 24px;
}

.avatar-preview {
    width: 128px;
    height: 128px;
    border-radius: 50%;
    background: #21262d;
    border: 1px solid #30363d;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    color: #58a6ff;
    overflow: hidden;
}

.avatar-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.avatar-upload-controls {
    flex: 1;
}

.file-input-wrapper {
    position: relative;
    display: inline-block;
}

.file-input-wrapper input[type="file"] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}

.file-input-label {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: #21262d;
    border: 1px solid #30363d;
    border-radius: 6px;
    color: #c9d1d9;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s ease;
}

.file-input-label:hover {
    background: #30363d;
    border-color: #8b949e;
}

/* Buttons */
.btn-save {
    background: #238636;
    color: #ffffff;
    border: 1px solid rgba(240,246,252,0.1);
    padding: 8px 20px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s ease;
}

.btn-save:hover {
    background: #2ea043;
}

.btn-cancel {
    background: transparent;
    color: #c9d1d9;
    border: 1px solid #30363d;
    padding: 8px 20px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-block;
}

.btn-cancel:hover {
    background: #21262d;
    border-color: #8b949e;
    text-decoration: none;
}

.form-actions {
    display: flex;
    gap: 12px;
    padding-top: 16px;
}

/* Responsive */
@media (max-width: 768px) {
    .settings-layout {
        grid-template-columns: 1fr;
    }

    .settings-nav {
        display: flex;
        overflow-x: auto;
    }

    .settings-nav-item {
        white-space: nowrap;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="settings-page">
    <div class="settings-layout">
        <!-- Left Navigation -->
        <aside class="settings-nav">
            <a href="{% url 'core_app:profile_edit' %}" class="settings-nav-item active">
                <i class="fas fa-user"></i>
                <span>Public profile</span>
            </a>
            <a href="#" class="settings-nav-item">
                <i class="fas fa-lock"></i>
                <span>Account</span>
            </a>
            <a href="{% url 'core_app:appearance' %}" class="settings-nav-item">
                <i class="fas fa-palette"></i>
                <span>Appearance</span>
            </a>
            <a href="#" class="settings-nav-item">
                <i class="fas fa-bell"></i>
                <span>Notifications</span>
            </a>
            <a href="#" class="settings-nav-item">
                <i class="fas fa-shield-alt"></i>
                <span>Security</span>
            </a>
            <a href="#" class="settings-nav-item">
                <i class="fas fa-key"></i>
                <span>API keys</span>
            </a>
        </aside>

        <!-- Right Content -->
        <main class="settings-content">
            <div class="settings-header">
                <h1 class="settings-title">Public profile</h1>
                <p class="settings-subtitle">
                    This information will be displayed publicly on your profile at
                    <a href="/{{ user.username }}/">/{{ user.username }}/</a>
                </p>
            </div>

            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Profile Picture -->
                <div class="form-section">
                    <h2 class="form-section-title">Profile picture</h2>
                    <div class="avatar-upload">
                        <div class="avatar-preview">
                            {% if profile.avatar %}
                                <img src="{{ profile.avatar.url }}" alt="{{ user.username }}">
                            {% else %}
                                {{ user.username|slice:":1"|upper }}
                            {% endif %}
                        </div>
                        <div class="avatar-upload-controls">
                            <div class="file-input-wrapper">
                                <input type="file" name="avatar" id="avatar-input" accept="image/*">
                                <label for="avatar-input" class="file-input-label">
                                    <i class="fas fa-upload"></i>
                                    <span>Upload new picture</span>
                                </label>
                            </div>
                            <p class="form-help" style="margin-top: 8px;">
                                Max size: 2MB. Recommended: 500x500px square image.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Basic Information -->
                <div class="form-section">
                    <h2 class="form-section-title">Basic information</h2>

                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" value="{{ user.username }}" disabled>
                        <p class="form-help">Username cannot be changed</p>
                    </div>

                    <div class="form-group">
                        <label for="first_name">First name</label>
                        <input type="text" id="first_name" name="first_name" value="{{ user.first_name }}">
                    </div>

                    <div class="form-group">
                        <label for="last_name">Last name</label>
                        <input type="text" id="last_name" name="last_name" value="{{ user.last_name }}">
                    </div>

                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" value="{{ user.email }}" required>
                    </div>

                    <div class="form-group">
                        <label for="bio">Bio</label>
                        <textarea id="bio" name="bio" placeholder="Tell us about yourself...">{{ profile.bio }}</textarea>
                        <p class="form-help">Brief description for your profile. Markdown is not supported.</p>
                    </div>
                </div>

                <!-- Location & Institution -->
                <div class="form-section">
                    <h2 class="form-section-title">Location & Affiliation</h2>

                    <div class="form-group">
                        <label for="location">Location</label>
                        <input type="text" id="location" name="location" value="{{ profile.location }}" placeholder="e.g., Tokyo, Japan">
                    </div>

                    <div class="form-group">
                        <label for="institution">Institution</label>
                        <input type="text" id="institution" name="institution" value="{{ profile.institution }}" placeholder="e.g., The University of Tokyo">
                    </div>
                </div>

                <!-- Links -->
                <div class="form-section">
                    <h2 class="form-section-title">Links</h2>

                    <div class="form-group">
                        <label for="website">Website</label>
                        <input type="url" id="website" name="website" value="{{ profile.website }}" placeholder="https://your-website.com">
                    </div>

                    <div class="form-group">
                        <label for="twitter">Twitter</label>
                        <input type="text" id="twitter" name="twitter" value="{{ profile.twitter }}" placeholder="username (without @)">
                    </div>

                    <div class="form-group">
                        <label for="google_scholar">Google Scholar</label>
                        <input type="url" id="google_scholar" name="google_scholar" value="{{ profile.google_scholar }}" placeholder="https://scholar.google.com/citations?user=...">
                    </div>

                    <div class="form-group">
                        <label for="orcid">ORCID</label>
                        <input type="text" id="orcid" name="orcid" value="{{ profile.orcid }}" placeholder="0000-0000-0000-0000">
                        <p class="form-help">Your ORCID identifier (e.g., 0000-0001-2345-6789)</p>
                    </div>
                </div>

                <!-- Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn-save">
                        <i class="fas fa-check"></i>
                        Save changes
                    </button>
                    <a href="/{{ user.username }}/" class="btn-cancel">Cancel</a>
                </div>
            </form>
        </main>
    </div>
</div>

<script>
// Preview avatar before upload
document.getElementById('avatar-input')?.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.querySelector('.avatar-preview');
            preview.innerHTML = `<img src="${e.target.result}" alt="Avatar preview">`;
        };
        reader.readAsDataURL(file);
    }
});
</script>
{% endblock %}
