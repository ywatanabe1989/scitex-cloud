{% extends 'base.html' %}
{% load static %}
{% block title %}
    {{
    page_title|default:"Project Library" }} - SciTeX Cloud
{% endblock %}
{% block
    extra_css %}
    <link rel="stylesheet"
          href="{% static 'shared/css/components/buttons.css' %}" />
    <style>
  .project-header {
    background: linear-gradient(135deg, #1a2332 0%, #2c3e50 100%);
    color: white;
    padding: 2rem;
    border-radius: 8px;
    margin-bottom: 2rem;
  }

  .project-title {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .project-meta {
    opacity: 0.9;
    font-size: 0.95rem;
  }

  .project-actions {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
    flex-wrap: wrap;
  }

  .btn-project {
    background: #34495e;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    text-decoration: none;
    font-size: 0.9rem;
  }

  .btn-project:hover {
    background: #2c3e50;
    color: white;
  }

  .library-stats {
    background: white;
    border: 1px solid #e5e5e5;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    display: flex;
    gap: 2rem;
    flex-wrap: wrap;
  }

  .stat-item {
    text-align: center;
  }

  .stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #1a2332;
  }

  .stat-label {
    color: #666;
    font-size: 0.9rem;
  }

  .paper-list {
    background: white;
    border: 1px solid #e5e5e5;
    border-radius: 8px;
    padding: 1.5rem;
  }

  .paper-item {
    border-bottom: 1px solid #f0f0f0;
    padding: 1.5rem 0;
  }

  .paper-item:last-child {
    border-bottom: none;
  }

  .paper-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .paper-meta {
    color: #666;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }

  .paper-notes {
    background: #f8f9fa;
    padding: 0.75rem;
    border-radius: 4px;
    margin: 0.5rem 0;
    font-size: 0.9rem;
  }

  .paper-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }

  .breadcrumb {
    margin-bottom: 1.5rem;
  }

  .breadcrumb a {
    color: #007acc;
    text-decoration: none;
  }

  .breadcrumb a:hover {
    text-decoration: underline;
  }

  .empty-state {
    text-align: center;
    padding: 3rem;
    color: #666;
  }
    </style>
{% endblock %}
{% block content %}
    <div class="container-fluid">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="{% url 'project_app:list' %}">Projects</a> /
            <a href="{% url 'project_app:detail' project.pk %}">{{ project.name }}</a> /
            Paper Library
        </nav>
        <!-- Project Header -->
        <div class="project-header">
            <div class="project-title">üìö Paper Library - {{ project.name }}</div>
            <div class="project-meta">Manage and organize papers saved to this research project</div>
            <div class="project-actions">
                <a href="{% url 'project_app:detail' project.pk %}" class="btn-project">‚Üê Back to Project</a>
                <a href="{% url 'scholar_app:project_search' project.pk %}"
                   class="btn-project">üîç Search Papers</a>
                <a href="{% url 'scholar_app:personal_library' %}" class="btn-project">üåê Global Library</a>
            </div>
        </div>
        <!-- Library Stats -->
        <div class="library-stats">
            <div class="stat-item">
                <div class="stat-number">{{ paper_count|default:0 }}</div>
                <div class="stat-label">Saved Papers</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ collections.count|default:0 }}</div>
                <div class="stat-label">Collections</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ project.status|capfirst }}</div>
                <div class="stat-label">Project Status</div>
            </div>
        </div>
        <!-- Paper List -->
        <div class="paper-list">
            <h3>Saved Papers</h3>
            {% if saved_papers %}
                {% for library_paper in saved_papers %}
                    <div class="paper-item">
                        <div class="paper-title">
                            <a href="{{ library_paper.paper.external_url }}"
                               target="_blank"
                               style="color: #1a2332">{{ library_paper.paper.title }}</a>
                        </div>
                        <div class="paper-meta">
                            {% if library_paper.paper.authors %}
                                {{ library_paper.paper.authors }}{%
                                else %}Authors not available
                            {% endif %}
                            |
                            {% if library_paper.paper.year
                                %}
                                {{ library_paper.paper.year }}
                            {% else %}
                                Year not available
                            {% endif %}
                            |
                            {% if library_paper.paper.journal %}
                                {{ library_paper.paper.journal
                                }}
                            {% else %}
                                Journal not available
                            {% endif %}
                        </div>
                        <div class="paper-meta">
                            Saved: {{ library_paper.saved_at|date:"M j, Y" }} | Reading Status: {{
                            library_paper.get_reading_status_display|default:"Not set" }}
                        </div>
                        {% if library_paper.personal_notes %}
                            <div class="paper-notes">
                                <strong>Notes:</strong> {{ library_paper.personal_notes }}
                            </div>
                        {% endif %}
                        <div class="paper-actions">
                            <a href="{{ library_paper.paper.external_url }}"
                               target="_blank"
                               class="btn btn-sm btn-primary">View Paper</a>
                            {% if library_paper.personal_pdf %}
                                <a href="{{ library_paper.personal_pdf.url }}"
                                   class="btn btn-sm btn-secondary">Download PDF</a>
                            {% endif %}
                            <button onclick="editNotes({{ library_paper.pk }})"
                                    class="btn btn-sm btn-outline-secondary">Edit Notes</button>
                            <button onclick="removePaper({{ library_paper.pk }})"
                                    class="btn btn-sm btn-outline-danger">Remove</button>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <h4>No papers saved yet</h4>
                    <p>
                        Search for papers and save them to this project to build your research
                        library.
                    </p>
                    <a href="{% url 'scholar_app:project_search' project.pk %}"
                       class="btn btn-primary">üîç Start Searching</a>
                </div>
            {% endif %}
        </div>
    </div>
    <script>
  function editNotes(libraryPaperId) {
    // In a real implementation, this would open a modal or form
    const notes = prompt("Edit your notes for this paper:");
    if (notes !== null) {
      alert("Notes updated! (Implementation needed)");
      // AJAX call to update notes
    }
  }

  function removePaper(libraryPaperId) {
    if (confirm("Remove this paper from the project library?")) {
      alert("Paper removed! (Implementation needed)");
      // AJAX call to remove paper
    }
  }
    </script>
{% endblock %}
