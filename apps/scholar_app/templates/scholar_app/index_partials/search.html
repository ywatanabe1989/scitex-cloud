{% load static %}
<!-- RIGHT PANEL: Literature Search -->
<div class="split-panel" id="searchPanel">
    <div class="panel-header" onclick="togglePanel('search')">
        <div>
            <i class="fas fa-search"></i> <span class="panel-title">Literature Search</span>
        </div>
        <i class="fas fa-expand-alt toggle-icon"></i>
    </div>
    <div class="panel-content">
        <div class="search-card-inner">
            <form id="literatureSearchForm" method="get" action="{% url 'scholar_app:simple_search' %}">
                <div class="input-group input-group-lg">
                    <input type="text" name="q" class="form-control search-input"
                           placeholder="Enter keywords here..."
                           value="{{ query }}" autofocus>
                    <button type="submit" class="btn search-btn" id="searchButton">
                        Search
                    </button>
                </div>

                <div class="mt-3">
                    <!-- Advanced Filters Toggle -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <small style="color: var(--color-fg-default); font-weight: 600;">Filters:</small>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="toggleAdvancedFilters" style="border-color: var(--scitex-color-05); color: var(--color-fg-default); background: var(--color-canvas-subtle);">
                            <i class="fas fa-sliders-h"></i> Advanced Filters
                        </button>
                    </div>

                    <!-- Basic Filters -->
                    <div id="basicFilters" class="row g-3 mb-3">
                        <!-- Source Selection -->
                        <div class="col-md-6">
                            <label class="form-label fw-bold u-text-default">Search Sources:</label>
                            <div class="d-flex flex-wrap gap-2">
                                <div class="scitex-toggle-wrapper">
                                    <input class="scitex-toggle all-sources-toggle" type="checkbox" id="source_all_toggle" {% if not request.GET.source_pubmed and not request.GET.source_google_scholar and not request.GET.source_arxiv and not request.GET.source_semantic %}checked{% endif %}>
                                    <label class="scitex-toggle-label" for="source_all_toggle">All Sources</label>
                                </div>
                                <div class="scitex-toggle-wrapper">
                                    <input class="scitex-toggle source-toggle" type="checkbox" name="source_pubmed" id="source_pubmed" value="pubmed" {% if request.GET.source_pubmed %}checked{% endif %}>
                                    <label class="scitex-toggle-label" for="source_pubmed">PubMed</label>
                                </div>
                                <div class="scitex-toggle-wrapper">
                                    <input class="scitex-toggle source-toggle" type="checkbox" name="source_google_scholar" id="source_google_scholar" value="google_scholar" {% if request.GET.source_google_scholar %}checked{% endif %}>
                                    <label class="scitex-toggle-label" for="source_google_scholar">Google Scholar</label>
                                </div>
                                <div class="scitex-toggle-wrapper">
                                    <input class="scitex-toggle source-toggle" type="checkbox" name="source_arxiv" id="source_arxiv" value="arxiv" {% if request.GET.source_arxiv %}checked{% endif %}>
                                    <label class="scitex-toggle-label" for="source_arxiv">arXiv</label>
                                </div>
                                <div class="scitex-toggle-wrapper">
                                    <input class="scitex-toggle source-toggle" type="checkbox" name="source_semantic" id="source_semantic" value="semantic" {% if request.GET.source_semantic %}checked{% endif %}>
                                    <label class="scitex-toggle-label" for="source_semantic">Semantic Scholar</label>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Filters -->
                        <div class="col-md-6">
                            <label class="form-label fw-bold u-text-default">Quick Filters:</label>
                            <div class="d-flex flex-wrap gap-2">
                                <div class="scitex-checkbox-wrapper">
                                    <input class="scitex-checkbox" type="checkbox" name="open_access" id="open_access" {% if request.GET.open_access %}checked{% endif %}>
                                    <label class="scitex-checkbox-label" for="open_access">Open Access Only</label>
                                </div>
                                <div class="scitex-checkbox-wrapper">
                                    <input class="scitex-checkbox" type="checkbox" name="recent_only" id="recent_only" {% if request.GET.recent_only %}checked{% endif %}>
                                    <label class="scitex-checkbox-label" for="recent_only">Last 5 Years</label>
                                </div>
                                <div class="scitex-checkbox-wrapper">
                                    <input class="scitex-checkbox" type="checkbox" name="high_impact" id="high_impact" {% if request.GET.high_impact %}checked{% endif %}>
                                    <label class="scitex-checkbox-label" for="high_impact">High Impact (IF > 5)</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Filters -->
                    <div id="advancedFilters" class="border rounded p-3 mb-3" style="display: none; background: #f8f9fa;">
                        <div class="row g-3">
                            <!-- Year Range -->
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Publication Year Range:</label>
                                <div class="d-flex gap-2 align-items-center">
                                    <input type="number" name="year_from" class="form-control form-control-sm" placeholder="From" min="1900" max="2024" value="{{ request.GET.year_from }}">
                                    <span>to</span>
                                    <input type="number" name="year_to" class="form-control form-control-sm" placeholder="To" min="1900" max="2024" value="{{ request.GET.year_to }}">
                                </div>
                            </div>

                            <!-- Citation Count -->
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Minimum Citations:</label>
                                <select name="min_citations" class="form-select form-select-sm">
                                    <option value="" {% if not request.GET.min_citations %}selected{% endif %}>Any</option>
                                    <option value="10" {% if request.GET.min_citations == '10' %}selected{% endif %}>10+</option>
                                    <option value="50" {% if request.GET.min_citations == '50' %}selected{% endif %}>50+</option>
                                    <option value="100" {% if request.GET.min_citations == '100' %}selected{% endif %}>100+</option>
                                    <option value="500" {% if request.GET.min_citations == '500' %}selected{% endif %}>500+</option>
                                    <option value="1000" {% if request.GET.min_citations == '1000' %}selected{% endif %}>1000+</option>
                                </select>
                            </div>

                            <!-- Impact Factor -->
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Journal Impact Factor:</label>
                                <select name="min_impact_factor" class="form-select form-select-sm">
                                    <option value="" {% if not request.GET.min_impact_factor %}selected{% endif %}>Any</option>
                                    <option value="1" {% if request.GET.min_impact_factor == '1' %}selected{% endif %}>1.0+</option>
                                    <option value="3" {% if request.GET.min_impact_factor == '3' %}selected{% endif %}>3.0+</option>
                                    <option value="5" {% if request.GET.min_impact_factor == '5' %}selected{% endif %}>5.0+</option>
                                    <option value="10" {% if request.GET.min_impact_factor == '10' %}selected{% endif %}>10.0+</option>
                                    <option value="20" {% if request.GET.min_impact_factor == '20' %}selected{% endif %}>20.0+</option>
                                </select>
                                <small class="text-muted">â†’ Check journal rankings at <a href="https://www.scimagojr.com/journalrank.php" target="_blank" class="text-decoration-none">ScimagoJR</a></small>
                            </div>

                            <!-- Author Filter -->
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Author(s):</label>
                                <input type="text" name="author" class="form-control form-control-sm" placeholder="e.g., Smith, Johnson" value="{{ request.GET.author }}">
                                <small class="text-muted">Separate multiple authors with commas</small>
                            </div>

                            <!-- Journal Filter -->
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Journal:</label>
                                <input type="text" name="journal" class="form-control form-control-sm" placeholder="e.g., Nature, Science" value="{{ request.GET.journal }}">
                                <small class="text-muted">Journal name or partial name</small>
                            </div>

                            <!-- Document Type -->
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Document Type:</label>
                                <select name="doc_type" class="form-select form-select-sm">
                                    <option value="" {% if not request.GET.doc_type %}selected{% endif %}>All Types</option>
                                    <option value="article" {% if request.GET.doc_type == 'article' %}selected{% endif %}>Research Article</option>
                                    <option value="review" {% if request.GET.doc_type == 'review' %}selected{% endif %}>Review</option>
                                    <option value="preprint" {% if request.GET.doc_type == 'preprint' %}selected{% endif %}>Preprint</option>
                                    <option value="conference" {% if request.GET.doc_type == 'conference' %}selected{% endif %}>Conference Paper</option>
                                </select>
                            </div>

                            <!-- Study Type -->
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Study Type:</label>
                                <select name="study_type" class="form-select form-select-sm">
                                    <option value="" {% if not request.GET.study_type %}selected{% endif %}>Any</option>
                                    <option value="clinical_trial" {% if request.GET.study_type == 'clinical_trial' %}selected{% endif %}>Clinical Trial</option>
                                    <option value="meta_analysis" {% if request.GET.study_type == 'meta_analysis' %}selected{% endif %}>Meta-Analysis</option>
                                    <option value="systematic_review" {% if request.GET.study_type == 'systematic_review' %}selected{% endif %}>Systematic Review</option>
                                    <option value="case_study" {% if request.GET.study_type == 'case_study' %}selected{% endif %}>Case Study</option>
                                </select>
                            </div>

                            <!-- Language -->
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Language:</label>
                                <select name="language" class="form-select form-select-sm">
                                    <option value="" {% if not request.GET.language %}selected{% endif %}>Any Language</option>
                                    <option value="english" {% if request.GET.language == 'english' %}selected{% endif %}>English</option>
                                    <option value="japanese" {% if request.GET.language == 'japanese' %}selected{% endif %}>Japanese</option>
                                    <option value="chinese" {% if request.GET.language == 'chinese' %}selected{% endif %}>Chinese</option>
                                    <option value="german" {% if request.GET.language == 'german' %}selected{% endif %}>German</option>
                                    <option value="french" {% if request.GET.language == 'french' %}selected{% endif %}>French</option>
                                </select>
                            </div>
                        </div>

                        <!-- Filter Actions -->
                        <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                            <div>
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="clearFilters">
                                    <i class="fas fa-times"></i> Clear All Filters
                                </button>
                                {% if user.is_authenticated %}
                                <button type="button" class="btn btn-outline-success btn-sm ms-2" id="saveSearch">
                                    <i class="fas fa-bookmark"></i> Save Search
                                </button>
                                {% endif %}
                            </div>
                            <div>
                                <span class="text-muted me-2">Active filters: <span id="activeFilterCount">0</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- Project Selection and Actions -->
                    <div class="d-flex flex-wrap gap-2 align-items-center">
                        {% if user.is_authenticated %}
                        <select name="project" class="form-select form-select-sm w-auto">
                            <option value="">Save to project...</option>
                            <option value="default">My Research</option>
                            <option value="ml-project">Machine Learning Project</option>
                            <option value="thesis">PhD Thesis</option>
                        </select>
                        <!-- Saved Searches Dropdown -->
                        <div class="dropdown">
                            <button class="btn btn-outline-info btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-history"></i> Saved Searches
                            </button>
                            <ul class="dropdown-menu">
                                <li><h6 class="dropdown-header">Recent Searches</h6></li>
                                <li><a class="dropdown-item" href="?q=neural+mechanisms+visual+attention">neural mechanisms visual attention</a></li>
                                <li><a class="dropdown-item" href="?q=machine+learning+neuroscience">machine learning neuroscience</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="showSavedSearches()"><i class="fas fa-bookmark"></i> Manage Saved Searches</a></li>
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
