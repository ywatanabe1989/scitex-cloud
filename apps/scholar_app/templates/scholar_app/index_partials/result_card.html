<div class="result-card" data-paper-id="{{ result.id }}" data-title="{{ result.title }}" data-authors="{{ result.authors }}" data-year="{{ result.year }}" data-journal="{{ result.journal|default:'Unknown Journal' }}" data-doi="{{ result.doi|default:'' }}" data-pmid="{{ result.pmid|default:'' }}" data-arxiv-id="{{ result.arxiv_id|default:'' }}" data-external-url="{{ result.external_url|default:'' }}" data-source="{{ result.source|default:'' }}">
    <div class="d-flex align-items-start gap-2">
        <div class="form-check mt-1">
            <input class="form-check-input paper-select-checkbox" type="checkbox" id="select_{{ result.id }}" data-paper-id="{{ result.id }}" data-doi="{{ result.doi|default:'' }}" data-title="{{ result.title }}">
            <label class="form-check-label" for="select_{{ result.id }}"></label>
        </div>
        <div class="flex-grow-1">
            <h6 class="result-title mb-0">
                <a href="#" class="text-decoration-none" onclick="viewOnWeb(this)">
                    {{ result.title }}
                </a>
            </h6>
        </div>
    </div>
    <div class="result-authors">
        {{ result.authors }}
    </div>
    <div class="d-flex align-items-center mt-2 flex-wrap">
        <span class="year-badge me-2">{{ result.year }}</span>
        {% if result.is_open_access %}
        <span class="open-access me-2">Open Access</span>
        {% endif %}
        {% if result.impact_factor %}
        <span class="badge bg-warning text-dark me-2 u-text-muted-xs">
            IF: {{ result.impact_factor }}
        </span>
        {% endif %}
        <small class="text-muted">
            <em>{{ result.journal|default:"Unknown Journal" }}</em>
            {% if result.citations and result.citations > 0 %}
                â€¢ <strong>{{ result.citations }} citations</strong>
                {% if result.citation_source %}
                    <span class="badge bg-light text-dark" style="font-size: 0.6rem;" title="Citation data source">{{ result.citation_source|upper }}</span>
                {% endif %}
            {% elif result.citations == 0 %}
                â€¢ <span class="text-muted">0 citations</span>
            {% else %}
                â€¢ <span class="text-muted">Citations unavailable</span>
            {% endif %}
            {% if result.pmid %}
                â€¢ PMID: {{ result.pmid }}
            {% endif %}
        </small>
        {% if result.source %}
        <span class="badge bg-info ms-2 u-text-muted-xs">{{ result.source|upper }}</span>
        {% endif %}
    </div>

    <!-- Abstract Section -->
    <div class="result-snippet mt-2">
        <div class="abstract-preview">
            {% if result.full_abstract and result.full_abstract|length > 200 %}
                <span class="abstract-short">{{ result.snippet|default:"No abstract available." }}</span>
                <span class="abstract-full u-hidden">{{ result.full_abstract }}</span>
                <a href="#" class="abstract-toggle text-primary ms-2 u-text-xs">[Show full abstract]</a>
            {% else %}
                {{ result.snippet|default:"No abstract available." }}
            {% endif %}
        </div>
    </div>
    <div class="mt-3">
        {% if result.pdf_url %}
        <a href="{{ result.pdf_url }}" class="btn btn-outline-success btn-sm me-2" target="_blank">
            ðŸ“„ Download PDF
        </a>
        {% else %}
        <span class="btn btn-outline-secondary btn-sm me-2 disabled">
            ðŸ“„ No PDF
        </span>
        {% endif %}
        {% if user.is_authenticated %}
        <a href="{% url 'scholar_app:paper_annotations' result.id %}" class="btn btn-outline-success btn-sm me-2">
            ðŸ’¬ Annotate
        </a>
        {% endif %}
    </div>
</div>
