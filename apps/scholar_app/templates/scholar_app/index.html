{% extends "scholar_app/scholar_base.html" %}
{% load static %}
{%block title%}
    SciTeX Scholar - Literature Search
{% endblock %}
{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'shared/css/common.css' %}" />
    <link rel="stylesheet" href="{% static 'scholar_app/css/index.css' %}" />
    <link rel="stylesheet" href="{% static 'scholar_app/css/index-inline.css' %}" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.css"
          rel="stylesheet" />
{% endblock %}
{% block extra_js %}
    <!-- Common Scripts -->
    <script type="module"
            src="{% static 'scholar_app/js/common/project-selector.js' %}"></script>
    <script type="module" src="{% static 'scholar_app/js/common/init-tabs.js' %}"></script>
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8"></script>
    <!-- BibTeX Scripts loaded dynamically in bibtex_partials/enrich.html -->
    <!-- Search Scripts -->
    <script type="module"
            src="{% static 'scholar_app/js/search/nouislider-init.js' %}"></script>
    <script type="module"
            src="{% static 'scholar_app/js/search/panel-toggle.js' %}"></script>
    <script type="module"
            src="{% static 'scholar_app/js/search/scitex-search.js' %}"></script>
    <script type="module"
            src="{% static 'scholar_app/js/search/advanced-sorting.js' %}"></script>
    <script type="module" src="{% static 'scholar_app/js/search/drag-sort.js' %}"></script>
    <script type="module"
            src="{% static 'scholar_app/js/search/swarm-plots.js' %}"></script>
    <script type="module"
            src="{% static 'scholar_app/js/common/scholar-index-main.js' %}"></script>
    <script type="module"
            src="{% static 'scholar_app/js/search/seekbar-integration.js' %}"></script>
    <script type="module" src="{% static 'scholar_app/js/search/search-ui.js' %}"></script>
    <!-- Initialization Scripts -->
    <script type="module"
            src="{% static 'scholar_app/js/init/swarm-plots-init.js' %}"></script>
{% endblock %}
{% block content %}
    <!-- Vertical Tab Layout -->
    <div class="u-mt-2 u-mb-3">
        <div class="vertical-tab-container">
            <!-- Vertical Tab Navigation -->
            <div class="scitex-tabs">
                <a href="#bibtex" class="scitex-tab tab-link" data-tab="bibtex">
                    <i class="fas fa-file-code"></i>
                    <span>BibTeX Enrichment</span>
                </a>
                <a href="#search" class="scitex-tab tab-link" data-tab="search">
                    <i class="fas fa-search"></i>
                    <span>Literature Search</span>
                </a>
            </div>
            <!-- Tab Content Container -->
            <div class="vertical-tab-content-container">
                <!-- BibTeX Enrichment Tab -->
                <div class="vertical-tab-content {% if active_tab == 'bibtex' %}active{% endif %}"
                     id="bibtex-tab"
                     data-tab="bibtex">{% include "scholar_app/bibtex_partials/enrich.html" %}</div>
                <!-- Literature Search Tab -->
                <div class="vertical-tab-content {% if active_tab == 'search' %}active{% endif %}"
                     id="search-tab"
                     data-tab="search">
                    {% include "scholar_app/search_partials/search.html" with show_results=True %}
                </div>
            </div>
        </div>
    </div>
    <!-- Configuration for JavaScript -->
    <div id="scholar-config-data"
         data-bibtex-upload-url="{% url 'scholar_app:bibtex_upload' %}"
         data-resource-status-url="{% url 'scholar_app:bibtex_resource_status' %}"
         data-scitex-search-url="{% url 'scholar_app:api_scitex_search' %}"
         data-scitex-capabilities-url="{% url 'scholar_app:api_scitex_capabilities' %}"
         data-user-authenticated="{% if user.is_authenticated %}true{% else %}false{% endif %}"
         data-user-projects='[{% for project in user_projects %}{"id": {{ project.id }}, "name": "{{ project.name|escapejs }}"}{% if not forloop.last %},{% endif %}{% endfor %}]'
         data-current-project='{% if current_project %}{"id": {{ current_project.id }}, "name": "{{ current_project.name|escapejs }}"}{% else %}null{% endif %}'
         {% if query and results %}
         data-search-results='[{% for result in results %}{"title": "{{ result.title|escapejs }}", "year": {% if result.year %}{{ result.year }}{% else %}null{% endif %}, "citations": {% if result.citations %}{{ result.citations }}{% else %}0{% endif %}, "impact_factor": {% if result.impact_factor %}{{ result.impact_factor }}{% else %}null{% endif %}, "authors": "{{ result.authors|escapejs }}", "journal": "{{ result.journal|escapejs }}", "url": "{{ result.url|escapejs }}"}{% if not forloop.last %},{% endif %}{% endfor %}]'
         {% endif %}>
    </div>
    <script type="module" src="{% static 'scholar_app/js/scholar-config-init.js' %}"></script>
{% endblock %}
