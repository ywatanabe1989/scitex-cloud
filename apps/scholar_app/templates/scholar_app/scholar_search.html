{% extends "scholar_app/scholar_base.html" %}
{% load static %}

{% block title %}SciTeX Scholar - Literature Search{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'shared/css/common.css' %}">
<link rel="stylesheet" href="{% static 'scholar_app/css/index.css' %}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container" style="padding-top: 2rem; padding-bottom: 2rem;">
  <div class="row">
    <!-- Main Content -->
    <div class="col-12">
      <!-- Page Header -->
      <div class="page-header mb-4">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 16px;">
          <div>
            <h1 class="h3 mb-3">Literature Search</h1>
            <p class="text-muted">Search across multiple academic databases to find relevant research papers</p>
          </div>
          <a href="{% url 'scholar_app:scholar_bibtex' %}" class="btn btn-outline-primary" style="white-space: nowrap;">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor" style="margin-right: 6px; vertical-align: text-bottom;">
              <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.71l-5.223 2.206A.5.5 0 0 1 2 15.5V2zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1H4z"/>
            </svg>
            BibTeX Enrichment
          </a>
        </div>
      </div>

      <!-- Literature Search Content -->
      <div class="card">
        <div class="card-body">
          {% include "scholar_app/search_partials/search.html" with show_results=True %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Configuration for JavaScript -->
<script>
  // Django template variables for JavaScript
  window.SCHOLAR_CONFIG = {
    urls: {
      bibtexUpload: '{% url "scholar_app:bibtex_upload" %}',
      resourceStatus: '{% url "scholar_app:bibtex_resource_status" %}',
      scitexSearch: '{% url "scholar_app:api_scitex_search" %}',
      scitexCapabilities: '{% url "scholar_app:api_scitex_capabilities" %}'
    },
    user: {
      isAuthenticated: {% if user.is_authenticated %}true{% else %}false{% endif %}
    }
  };

  // Set user projects for save functionality
  window.userProjects = [
    {% for project in user_projects %}
    {
      id: {{ project.id }},
      name: "{{ project.name|escapejs }}"
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
  ];

  // Set current project if available
  window.currentProject = {% if current_project %}{ id: {{ current_project.id }}, name: "{{ current_project.name|escapejs }}" }{% else %}null{% endif %};

  {% if query and results %}
  // Serialize Django search results for swarm plots
  window.SCHOLAR_SEARCH_RESULTS = [
    {% for result in results %}
    {
      title: "{{ result.title|escapejs }}",
      year: {% if result.year %}{{ result.year }}{% else %}null{% endif %},
      citations: {% if result.citations %}{{ result.citations }}{% else %}0{% endif %},
      impact_factor: {% if result.impact_factor %}{{ result.impact_factor }}{% else %}null{% endif %},
      authors: "{{ result.authors|escapejs }}",
      journal: "{{ result.journal|escapejs }}",
      url: "{{ result.url|escapejs }}"
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
  ];
  {% endif %}
</script>

{% endblock %}

{% block extra_js %}
<!-- Common Scripts -->
<script type="module" src="{% static 'scholar_app/js/common/project-selector.js' %}"></script>
<!-- External Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js"></script>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8"></script>
<!-- Search Scripts -->
<script type="module" src="{% static 'scholar_app/js/search/nouislider-init.js' %}"></script>
<script type="module" src="{% static 'scholar_app/js/search/panel-toggle.js' %}"></script>
<!-- Unified search disabled - using Django server-side search instead -->
<!-- <script type="module" src="{% static 'scholar_app/js/search/scitex-search.js' %}"></script> -->
<script type="module" src="{% static 'scholar_app/js/search/advanced-sorting.js' %}"></script>
<script type="module" src="{% static 'scholar_app/js/search/drag-sort.js' %}"></script>
<script type="module" src="{% static 'scholar_app/js/search/swarm-plots.js' %}"></script>
<script type="module" src="{% static 'scholar_app/js/common/scholar-index-main.js' %}"></script>
<script type="module" src="{% static 'scholar_app/js/search/seekbar-integration.js' %}"></script>
<script type="module" src="{% static 'scholar_app/js/search/search-ui.js' %}"></script>
<!-- Initialization Scripts -->
<script type="module" src="{% static 'scholar_app/js/init/swarm-plots-init.js' %}"></script>
{% endblock %}