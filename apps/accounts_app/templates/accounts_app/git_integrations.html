{% extends "base.html" %}
{% load static %}

{% block title %}Git Integrations - Settings{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/common/settings-layout.css' %}">
<style>
/* Git integrations page-specific styles */

.form-section {
    background: var(--color-canvas-default);
    border: 1px solid var(--color-border-default);
    border-radius: 6px;
    padding: 24px;
    margin-bottom: 24px;
}

.section-header {
    margin-bottom: 16px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--color-border-default);
}

.section-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--color-fg-default);
    margin-bottom: 4px;
}

.section-subtitle {
    font-size: 14px;
    color: var(--color-fg-muted);
}

.form-group {
    margin-bottom: 16px;
}

.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: var(--color-fg-default);
    margin-bottom: 6px;
}

.form-group input[type="password"],
.form-group input[type="text"] {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid var(--color-border-default);
    border-radius: 6px;
    background: var(--color-canvas-default);
    color: var(--color-fg-default);
    font-size: 14px;
}

.form-help {
    font-size: 12px;
    color: var(--color-fg-muted);
    margin-top: 6px;
}

.form-help a {
    color: var(--scitex-color-04);
}

.form-actions {
    display: flex;
    gap: 12px;
    padding-top: 16px;
    border-top: 1px solid var(--color-border-default);
    margin-top: 24px;
}

.btn-save {
    background: var(--color-btn-primary-bg);
    color: var(--color-btn-primary-text);
    border: 1px solid var(--color-btn-primary-border);
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-cancel {
    background: var(--color-btn-bg);
    color: var(--color-btn-text);
    border: 1px solid var(--color-btn-border);
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 14px;
    text-decoration: none;
}
</style>
{% endblock %}

{% block content %}
<div class="settings-page">
    <div class="settings-layout">
        <!-- Left Navigation -->
        <aside class="settings-nav">
            {% include 'accounts_app/partials/settings_nav.html' with active='git_integrations' %}
        </aside>

        <!-- Right Content -->
        <main class="settings-content">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}

                {% if messages %}
                <div style="margin-bottom: 16px;">
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}" style="padding: 12px; background: {% if message.tags == 'success' %}var(--scitex-success){% else %}var(--scitex-error){% endif %}; color: white; border-radius: 6px; margin-bottom: 8px;">
                        {{ message }}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <div class="form-section">
                    <div class="section-header">
                        <h2 class="section-title">Git Platform Integration</h2>
                        <p class="section-subtitle">Connect your GitHub, GitLab, and Bitbucket accounts to import private repositories</p>
                    </div>

                    <div class="form-group">
                        <label for="github_token">GitHub Personal Access Token</label>
                        <input type="password" id="github_token" name="github_token"
                               value=""
                               placeholder="{% if github_token_masked %}{{ github_token_masked }}{% else %}ghp_xxxxxxxxxxxx or github_pat_xxxxx{% endif %}">
                        <p class="form-help">
                            {% if profile.github_token %}
                                ✅ Token saved: <code style="background: var(--color-canvas-subtle); padding: 2px 6px; border-radius: 3px; font-size: 12px;">{{ github_token_masked }}</code>
                            {% else %}
                                No token saved
                            {% endif %} •
                            <a href="https://github.com/settings/tokens" target="_blank">Create token on GitHub →</a>
                        </p>
                    </div>

                    <div class="form-group">
                        <label for="gitlab_token">GitLab Personal Access Token</label>
                        <input type="password" id="gitlab_token" name="gitlab_token"
                               value=""
                               placeholder="{% if gitlab_token_masked %}{{ gitlab_token_masked }}{% else %}glpat-xxxxxxxxxxxx{% endif %}">
                        <p class="form-help">
                            {% if profile.gitlab_token %}
                                ✅ Token saved: <code style="background: var(--color-canvas-subtle); padding: 2px 6px; border-radius: 3px; font-size: 12px;">{{ gitlab_token_masked }}</code>
                            {% else %}
                                No token saved
                            {% endif %} •
                            <a href="https://gitlab.com/-/profile/personal_access_tokens" target="_blank">Create token on GitLab →</a>
                        </p>
                    </div>

                    <div class="form-group">
                        <label for="bitbucket_token">Bitbucket App Password</label>
                        <input type="password" id="bitbucket_token" name="bitbucket_token"
                               value=""
                               placeholder="{% if bitbucket_token_masked %}{{ bitbucket_token_masked }}{% else %}ATBB...{% endif %}">
                        <p class="form-help">
                            {% if profile.bitbucket_token %}
                                ✅ Password saved: <code style="background: var(--color-canvas-subtle); padding: 2px 6px; border-radius: 3px; font-size: 12px;">{{ bitbucket_token_masked }}</code>
                            {% else %}
                                No password saved
                            {% endif %} •
                            <a href="https://bitbucket.org/account/settings/app-passwords/" target="_blank">Create app password on Bitbucket →</a>
                        </p>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <h2 class="section-title">Git Hosting Profiles</h2>
                        <p class="section-subtitle">Your public profile usernames on different Git platforms</p>
                    </div>

                    <div class="form-group">
                        <label for="github_profile">GitHub Username</label>
                        <input type="text" id="github_profile" name="github_profile" value="{{ profile.github_profile }}" placeholder="username">
                        <p class="form-help">Your GitHub profile: github.com/<span id="github-preview">{{ profile.github_profile|default:"username" }}</span></p>
                    </div>

                    <div class="form-group">
                        <label for="gitlab_profile">GitLab Username</label>
                        <input type="text" id="gitlab_profile" name="gitlab_profile" value="{{ profile.gitlab_profile }}" placeholder="username">
                        <p class="form-help">Your GitLab profile: gitlab.com/<span id="gitlab-preview">{{ profile.gitlab_profile|default:"username" }}</span></p>
                    </div>

                    <div class="form-group">
                        <label for="bitbucket_profile">Bitbucket Username</label>
                        <input type="text" id="bitbucket_profile" name="bitbucket_profile" value="{{ profile.bitbucket_profile }}" placeholder="username">
                        <p class="form-help">Your Bitbucket profile: bitbucket.org/<span id="bitbucket-preview">{{ profile.bitbucket_profile|default:"username" }}</span></p>
                    </div>
                </div>

                <!-- Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn-save">
                        <i class="fas fa-check"></i>
                        Save changes
                    </button>
                    <a href="{% url 'accounts_app:profile_edit' %}" class="btn-cancel">Cancel</a>
                </div>
            </form>
        </main>
    </div>
</div>
{% endblock %}
