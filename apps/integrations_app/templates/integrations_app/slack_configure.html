{% extends "global_base.html" %}

{% block title %}Configure Slack - SciTeX{% endblock %}

{% block content %}
<div class="container py-4" style="max-width: 600px;">
    <h1 class="mb-4">Configure Slack Notifications</h1>

    <div class="card">
        <div class="card-body">
            <form method="post">
                {% csrf_token %}

                <div class="mb-4">
                    <label for="webhook_url" class="form-label">
                        Webhook URL <span class="text-danger">*</span>
                    </label>
                    <input
                        type="url"
                        name="webhook_url"
                        id="webhook_url"
                        required
                        class="form-control"
                        placeholder="https://hooks.slack.com/services/..."
                    >
                    <div class="form-text">
                        Get your webhook URL from Slack:
                        <a href="https://api.slack.com/messaging/webhooks" target="_blank" class="text-decoration-none">
                            Create Incoming Webhook
                        </a>
                    </div>
                </div>

                <div class="mb-4">
                    <label for="channel" class="form-label">
                        Channel (optional)
                    </label>
                    <input
                        type="text"
                        name="channel"
                        id="channel"
                        class="form-control"
                        placeholder="#general"
                    >
                    <div class="form-text">
                        Override default channel (leave empty to use webhook default)
                    </div>
                </div>

                <div class="mb-4">
                    <label class="form-label">
                        Notification Events <span class="text-danger">*</span>
                    </label>
                    <div class="d-flex flex-column gap-2">
                        {% for value, label in available_events %}
                        <div class="form-check">
                            <input
                                type="checkbox"
                                name="enabled_events"
                                value="{{ value }}"
                                id="event_{{ value }}"
                                {% if value == 'project_created' or value == 'manuscript_updated' or value == 'analysis_completed' %}checked{% endif %}
                                class="form-check-input"
                            >
                            <label class="form-check-label" for="event_{{ value }}">
                                {{ label }}
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary flex-fill">
                        Save Configuration
                    </button>
                    <a href="{% url 'integrations_app:dashboard' %}" class="btn btn-outline-secondary flex-fill">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>

    <div class="alert alert-info mt-4" role="alert">
        <div class="d-flex align-items-start">
            <div style="min-width: 20px; margin-right: 12px;">
                <svg style="width: 20px; height: 20px;" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                </svg>
            </div>
            <div>
                <strong>How to get a Slack webhook URL:</strong><br>
                1. Go to <a href="https://api.slack.com/messaging/webhooks" target="_blank" class="alert-link">Slack's Incoming Webhooks page</a><br>
                2. Click "Create New App" and choose your workspace<br>
                3. Enable Incoming Webhooks and add a new webhook<br>
                4. Copy the webhook URL and paste it above
            </div>
        </div>
    </div>
</div>
{% endblock %}
