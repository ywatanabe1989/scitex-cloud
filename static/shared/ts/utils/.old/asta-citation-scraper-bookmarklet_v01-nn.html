<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Asta AI Citation Scraper - Bookmarklet | SciTeX</title>
    <link
      rel="icon"
      type="image/png"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%232c3e50'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white' font-family='Arial,sans-serif' font-weight='bold'>S</text></svg>"
    />
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        line-height: 1.6;
      }
      .header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
      }
      .scitex-logo {
        width: 50px;
        height: 50px;
        background: #2c3e50;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 32px;
        font-weight: bold;
        font-family: Arial, sans-serif;
        flex-shrink: 0;
      }
      h1 {
        color: #0fcb8c;
        margin: 0;
      }
      .subtitle {
        color: #6b7280;
        font-size: 14px;
        margin-top: 5px;
      }
      .bookmarklet-container {
        background: #f0fdf7;
        border: 2px solid #0fcb8c;
        border-radius: 8px;
        padding: 20px;
        margin: 30px 0;
      }
      .bookmarklet-link {
        display: inline-block;
        background: #0fcb8c;
        color: white;
        padding: 15px 30px;
        text-decoration: none;
        border-radius: 6px;
        font-size: 18px;
        font-weight: bold;
        cursor: move;
        transition: all 0.2s;
      }
      .bookmarklet-link:hover {
        background: #0db87a;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(15, 203, 140, 0.3);
      }
      .instruction {
        background: #fff7ed;
        border-left: 4px solid #f59e0b;
        padding: 15px;
        margin: 20px 0;
      }
      .demo {
        background: #fef2f2;
        border-left: 4px solid #ef4444;
        padding: 15px;
        margin: 20px 0;
      }
      code {
        background: #e5e7eb;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: "Monaco", "Menlo", "Consolas", monospace;
      }
      .feature-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .feature-item {
        background: #f9fafb;
        padding: 15px;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="scitex-logo">S</div>
      <div>
        <h1>ğŸ“š Asta AI Citation Scraper</h1>
        <div class="subtitle">SciTeX Tools - Academic Research Assistant</div>
      </div>
    </div>

    <p>
      Automatically click all "Copy BibTeX" buttons on Asta AI and collect all
      citations in one go!
    </p>

    <div class="bookmarklet-container">
      <h2>ğŸ“Œ Installation (Drag to Bookmarks Bar)</h2>
      <p><strong>Drag this button to your bookmarks bar:</strong></p>
      <a
        href="javascript:(async function(){console.log('Asta AI Citation Scraper Starting...');window.focus();const btns=Array.from(document.querySelectorAll('button')).filter(b=>b.textContent.includes('Copy BibTeX')||b.textContent.includes('Copy')%26%26b.closest('[class*=citation]'));if(0===btns.length)return void alert('No Copy BibTeX buttons found.');console.log('Found '.concat(btns.length,' buttons'));const citations=[],wait=ms=>new Promise(r=>setTimeout(r,ms)),readClip=async()=>{try{window.focus();return await navigator.clipboard.readText()}catch(e){return null}},findBibTeX=elem=>{const p=elem.closest('[class*=citation],[class*=reference],[class*=paper]');if(!p)return null;const t=[p.innerText,p.textContent];for(const a of p.attributes)if(a.value%26%26a.value.includes('@'))return a.value;for(const x of t)if(x%26%26(x.includes('@article')||x.includes('@inproceedings')||x.includes('@book')))return x;const pre=p.querySelector('pre,code');return pre%26%26pre.textContent.includes('@')?pre.textContent:null},getTimestamp=()=>{const d=new Date,pad=n=>String(n).padStart(2,'0');return''.concat(d.getFullYear()).concat(pad(d.getMonth()%2B1)).concat(pad(d.getDate()),'-').concat(pad(d.getHours())).concat(pad(d.getMinutes())).concat(pad(d.getSeconds()))},notify=(msg,prog,eta)=>{let n=document.getElementById('scitex-notify');if(!n){n=document.createElement('div');n.id='scitex-notify';n.style.cssText='position:fixed;top:20px;right:20px;background:%230FCB8C;color:white;padding:20px;border-radius:8px;font-family:sans-serif;font-size:14px;z-index:9999999;box-shadow:0 4px 12px rgba(0,0,0,0.3);min-width:250px';document.body.appendChild(n)}const parts=['%3Cdiv style=%22font-weight:bold;margin-bottom:10px%22%3E',msg,'%3C/div%3E'];if(prog){parts.push('%3Cdiv style=%22margin:10px 0%22%3E',prog,'%3C/div%3E');const m=prog.match(/\\d%2B/g);if(m%26%26m.length%3E=2){const w=Math.round(m[0]/m[1]*100);parts.push('%3Cdiv style=%22background:rgba(255,255,255,0.3);border-radius:4px;height:8px;overflow:hidden;margin:8px 0%22%3E%3Cdiv style=%22background:white;height:100%25;width:',w,'%25;transition:width 0.3s%22%3E%3C/div%3E%3C/div%3E')}}if(eta)parts.push('%3Cdiv style=%22font-size:12px;opacity:0.9;margin-top:8px%22%3E',eta,'%3C/div%3E');n.innerHTML=decodeURIComponent(parts.join(''))},removeNotify=()=>{const n=document.getElementById('scitex-notify');if(n)setTimeout(()=>n.remove(),3000)};console.log('Trying DOM scraping...');for(let i=0;i%3Cbtns.length;i++){const bib=findBibTeX(btns[i]);if(bib%26%26bib.includes('@'))citations.push(bib.trim())}if(citations.length===btns.length){console.log('SUCCESS: DOM scraped!');const c=citations.join('\\n\\n'),fname='asta-citations-'.concat(getTimestamp(),'.bib'),b=new Blob([c],{type:'text/plain'}),u=URL.createObjectURL(b),a=document.createElement('a');a.href=u;a.download=fname;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(u);try{window.focus();await wait(100);await navigator.clipboard.writeText(c)}catch(e){}notify('Downloaded!',citations.length.toString().concat(' citations'),'File: '.concat(fname));removeNotify();return c}console.log('Fallback: clicking...');citations.length=0;let success=0,fail=0,start=Date.now();notify('Starting...','Found '.concat(btns.length,' citations'),'');for(let i=0;i%3Cbtns.length;i++){const btn=btns[i],num=String(i%2B1).padStart(2,'0'),total=String(btns.length).padStart(2,'0');notify('Processing Citations',num.concat('/',total),(i%3E0?'ETA: '.concat(Math.round((Date.now()-start)/i*(btns.length-i)/1000),'s'):'Calculating...'));console.log('Clicking ',(i%2B1),'/',btns.length);try{btn.scrollIntoView({behavior:'smooth',block:'center'});await wait(200);btn.click();await wait(400);const txt=await readClip();if(txt%26%26txt.trim()%26%26txt.includes('@'))citations.push(txt.trim()),success%2B%2B;else fail%2B%2B;await wait(100)}catch(e){console.error('Error ',(i%2B1),':',e);fail%2B%2B}}const c=citations.join('\\n\\n');if(c){try{const fname='asta-citations-'.concat(getTimestamp(),'.bib'),b=new Blob([c],{type:'text/plain'}),u=URL.createObjectURL(b),a=document.createElement('a');a.href=u;a.download=fname;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(u);try{window.focus();await wait(100);await navigator.clipboard.writeText(c)}catch(e){}notify('Downloaded!',success.toString().concat(' citations'),'File: '.concat(fname));removeNotify()}catch(e){notify('Error','Check console','');removeNotify()}}else{notify('No citations','Try again','');removeNotify()}return c})();"
        class="bookmarklet-link"
        title="Drag to bookmarks bar"
      >
        ğŸ“š SciTeX: Asta Citations
      </a>
      <p style="margin-top: 10px; font-size: 14px; color: #6b7280">
        ğŸ’¡ <strong>Bookmark name:</strong> "ğŸ“š SciTeX: Asta Citations" - Easy to
        find in your bookmarks!
      </p>
    </div>

    <div class="instruction">
      <h3>ğŸ“– How to Use</h3>
      <ol>
        <li>
          <strong>Drag</strong> the "ğŸ“š SciTeX: Asta Citations" button to your
          bookmarks bar
        </li>
        <li><strong>Open</strong> Asta AI chat with citations</li>
        <li><strong>Click</strong> the "ğŸ“š SciTeX: Asta Citations" bookmark</li>
        <li>
          <strong>Wait</strong> for it to process all citations (auto-scrolls
          and clicks)
        </li>
        <li><strong>Done!</strong> All citations are now in your clipboard</li>
      </ol>
    </div>

    <h2>âœ¨ Features</h2>
    <div class="feature-list">
      <div class="feature-item">
        <strong>âš¡ Lightning Fast</strong><br />
        Tries DOM scraping first (instant!)
      </div>
      <div class="feature-item">
        <strong>ğŸ“Š Live Progress</strong><br />
        Real-time counter: 01/33, 02/33...
      </div>
      <div class="feature-item">
        <strong>â±ï¸ ETA Display</strong><br />
        Shows estimated time remaining
      </div>
      <div class="feature-item">
        <strong>ğŸ“ˆ Progress Bar</strong><br />
        Visual progress indicator
      </div>
      <div class="feature-item">
        <strong>ğŸ’¾ Auto-Download</strong><br />
        Saves as .bib file automatically
      </div>
      <div class="feature-item">
        <strong>ğŸ“‹ Clipboard Copy</strong><br />
        Also copies to clipboard
      </div>
    </div>

    <h2>ğŸ¯ What It Does</h2>
    <ol>
      <li>Scans the page for all "Copy BibTeX" buttons</li>
      <li>
        <strong>âš¡ Fast Mode:</strong> Tries to extract BibTeX directly from DOM
        (instant!)
      </li>
      <li>
        <strong>ğŸ”„ Fallback Mode:</strong> If DOM scraping fails, clicks buttons
        sequentially
      </li>
      <li>
        <strong>ğŸ“Š Shows live notification</strong> with counter (01/33,
        02/33...), progress bar, and ETA
      </li>
      <li>Collects all BibTeX data</li>
      <li>Combines all citations with proper formatting</li>
      <li><strong>Automatically downloads as .bib file</strong></li>
      <li>Copies to clipboard as backup</li>
      <li>Notification auto-closes after 3 seconds</li>
    </ol>

    <h2>ğŸ“Š Example Output</h2>
    <pre
      style="
        background: #f9fafb;
        padding: 15px;
        border-radius: 6px;
        overflow-x: auto;
      "
    >
@article{smith2024,
  title={Example Paper},
  author={Smith, John},
  journal={Nature},
  year={2024}
}

@article{jones2024,
  title={Another Paper},
  author={Jones, Jane},
  journal={Science},
  year={2024}
}</pre
    >

    <div class="demo">
      <h3>ğŸ¬ Demo Workflow</h3>
      <ol>
        <li>Open Asta AI: <code>https://asta.allen.ai/chat/...</code></li>
        <li>Ask a question that generates citations</li>
        <li>Click the bookmarklet</li>
        <li><strong>See live notification</strong> in top-right corner</li>
        <li>
          <strong>Option A (Fast):</strong> Instant! Shows "5 citations"
          immediately
        </li>
        <li>
          <strong>Option B (Fallback):</strong> See counter "01/33, 02/33..." +
          progress bar + "ETA: 25s"
        </li>
        <li>Get .bib file downloaded automatically</li>
        <li>Notification shows success and auto-closes after 3 seconds</li>
        <li>Import .bib file into your reference manager</li>
      </ol>
    </div>

    <h2>ğŸ”§ Troubleshooting</h2>
    <ul>
      <li>
        <strong>No buttons found?</strong> Make sure you're on Asta AI chat page
        with citations visible
      </li>
      <li>
        <strong>Not all citations copied?</strong> Check browser console (F12)
        for detailed log
      </li>
      <li>
        <strong>Clipboard access denied?</strong> Grant clipboard permission to
        the Asta AI website
      </li>
      <li>
        <strong>Buttons not clicking?</strong> Some sites may have changed their
        HTML - check console for errors
      </li>
    </ul>

    <h2>ğŸ’¡ Tips</h2>
    <ul>
      <li>
        <strong>Watch the top-right notification!</strong> It shows real-time
        progress with counter and ETA
      </li>
      <li>
        <strong>Fast Mode usually works!</strong> Most of the time you'll get
        instant results
      </li>
      <li>Progress bar fills up as citations are collected</li>
      <li>ETA is calculated based on average time per citation</li>
      <li>The .bib file is named with timestamp for easy organization</li>
      <li>Don't switch tabs while fallback mode is running</li>
      <li>Notification auto-closes after 3 seconds on success</li>
    </ul>

    <h2>ğŸ”’ Privacy & Security</h2>
    <ul>
      <li>âœ… No data sent to external servers</li>
      <li>âœ… Only accesses clipboard (standard browser permission)</li>
      <li>âœ… Only clicks buttons on the current page</li>
      <li>âœ… Open source - you can inspect the code</li>
    </ul>

    <div
      style="
        margin-top: 50px;
        padding-top: 20px;
        border-top: 1px solid #e5e7eb;
        color: #6b7280;
        font-size: 14px;
        text-align: center;
      "
    >
      <div
        style="
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 10px;
          margin-bottom: 10px;
        "
      >
        <div
          style="
            width: 30px;
            height: 30px;
            background: #2c3e50;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
          "
        >
          S
        </div>
        <strong>SciTeX Cloud</strong>
      </div>
      <p style="margin: 5px 0">
        Asta AI Citation Scraper | Academic Research Tools
      </p>
      <p style="margin: 5px 0; font-size: 12px">
        Open source â€¢ Privacy-focused â€¢ Made for researchers
      </p>
    </div>
  </body>
</html>
