<!-- ---
!-- Timestamp: 2025-11-04 14:14:16
!-- Author: ywatanabe
!-- File: /home/ywatanabe/proj/scitex-cloud/RULES/01_DJANGO_ORGANIZATION_FULLSTACK_CHECKLIST.md
!-- --- -->

## DO NOT EDIT THIS FILE ITSELF. PLEASE WORK ON YOUR OWN TODO LIST. THIS FILE IS EDITABLE ONLY BY USER.

---

## AI Agent Checklist System

### Pre-Work Checklist

Before making ANY changes to the codebase, AI agents MUST verify:

- [ ] I have read the complete DJANGO_ORGANIZATION_FULLSTACK.md
- [ ] I understand the 1:1:1:1 correspondence principle
- [ ] I know which layer (Model/Service/View/Template) I'm working on
- [ ] I understand the import hierarchy (Models ← Services ← Views)
- [ ] I will NOT skip any layer in the stack

### Feature Creation Checklist

When creating a NEW feature, create ALL files in this order:

#### 1. Model Layer
- [ ] Created `models/{feature}/{model_name}.py`
- [ ] Added model to `models/__init__.py` exports
- [ ] Used string references for ForeignKey/ManyToMany
- [ ] NO business logic in model (only data structure)
- [ ] Added `__str__` method
- [ ] Configured `Meta` class (db_table, ordering)

#### 2. Service Layer
- [ ] Created `services/{feature}/{service_name}.py`
- [ ] Used `@staticmethod` or dependency injection
- [ ] ALL business logic is in service (not in view/model)
- [ ] Service methods have clear docstrings
- [ ] Validation logic is in service
- [ ] Service does NOT access `request` object

#### 3. View Layer
- [ ] Created `views/{feature}/{view_name}.py`
- [ ] View is thin (< 50 lines)
- [ ] View ONLY handles HTTP request/response
- [ ] Business logic delegated to service
- [ ] Authentication/permission decorators applied
- [ ] Returns render() or JsonResponse()

#### 4. Form Layer (if needed)
- [ ] Created `forms/{feature}/{form_name}.py`
- [ ] Form handles validation only
- [ ] Custom clean_* methods for field validation
- [ ] Form does NOT save data (service does this)

#### 5. Template Layer
- [ ] Created `templates/{app}/{feature}/{view_name}.html`
- [ ] Template extends appropriate base template
- [ ] NO inline styles (all in CSS file)
- [ ] Template uses {% load static %}
- [ ] Links CSS file in {% block extra_css %}
- [ ] Links JS file in {% block extra_js %}

#### 6. CSS Layer
- [ ] Created `static/{app}/css/{feature}/{view_name}.css`
- [ ] Imports common variables if needed
- [ ] NO inline styles in HTML
- [ ] CSS file matches template name exactly

#### 7. TypeScript Layer
- [ ] Created `static/{app}/ts/{feature}/{view_name}.ts`
- [ ] TypeScript file matches template name exactly
- [ ] Imports from shared utilities if needed
- [ ] Compiled to JS (check tsconfig.json)

#### 8. URL Layer
- [ ] Added route to `urls/{feature}.py`
- [ ] URL name matches view name
- [ ] URL includes app_name namespace
- [ ] Imported view from correct location

#### 9. Test Layer
- [ ] Created `tests/models/test_{model_name}.py`
- [ ] Created `tests/services/test_{service_name}.py`
- [ ] Created `tests/views/test_{view_name}.py`
- [ ] All tests pass

#### 10. Validation
- [ ] Run `python manage.py check_structure`
- [ ] Run `python manage.py test`
- [ ] All files follow naming conventions
- [ ] All layers have 1:1 correspondence

### File Modification Checklist

When MODIFYING existing files:

#### Before Modifying
- [ ] I verified the file's current location
- [ ] I checked if file is in correct feature directory
- [ ] I understand the file's layer responsibility
- [ ] I identified corresponding files in other layers

#### During Modification
- [ ] I stayed within layer responsibility (no mixing)
- [ ] If adding business logic → went to service layer
- [ ] If adding styles → went to CSS file (not inline)
- [ ] If adding UI logic → went to TypeScript file
- [ ] I updated corresponding test files

#### After Modification
- [ ] Corresponding files are still in sync
- [ ] Run `python manage.py check_structure`
- [ ] Tests still pass
- [ ] No inline styles added
- [ ] No business logic in wrong layer

### Code Review Checklist

When reviewing code, verify:

#### Structure
- [ ] All files in correct directories
- [ ] 1:1:1:1 correspondence maintained
- [ ] Feature grouping followed (not by file type)
- [ ] No files at wrong layer

#### Layer Separation
- [ ] Models: ONLY data structure
- [ ] Services: ONLY business logic
- [ ] Views: ONLY HTTP handling
- [ ] Templates: ONLY presentation
- [ ] No layer mixing

#### Naming
- [ ] Files match across layers (browse.html → browse.py → browse.css → browse.ts)
- [ ] Partials use underscore prefix (_header.html)
- [ ] Shared directories use correct names (shared/, common/, base/)
- [ ] No ambiguous names (utils.py, helpers.py without context)

#### Imports
- [ ] Import hierarchy followed (Models ← Services ← Views)
- [ ] No circular imports
- [ ] String references used in models
- [ ] No upward imports

#### Testing
- [ ] Tests exist for new code
- [ ] Tests cover all layers
- [ ] Tests are in correct directories
- [ ] All tests pass

### Migration Checklist

When migrating from monolithic structure:

#### Planning
- [ ] Identified largest/most painful file
- [ ] Mapped features to new structure
- [ ] Created migration plan (week by week)
- [ ] Team reviewed and approved plan

#### Execution (Per Feature)
- [ ] Created new directory structure
- [ ] Moved models to feature directories
- [ ] Created services (if not exist)
- [ ] Split views by feature
- [ ] Updated imports
- [ ] Updated tests
- [ ] Run `python manage.py check_structure`
- [ ] All tests pass

#### Cleanup
- [ ] Moved old files to `legacy/`
- [ ] Updated documentation
- [ ] Removed unused imports
- [ ] Verified no broken references

### Common Mistakes Checklist

AI agents MUST avoid these mistakes:

#### ❌ NEVER Do This
- [ ] Put business logic in models
- [ ] Put business logic in views
- [ ] Put business logic in templates
- [ ] Use inline styles in HTML
- [ ] Create utils.py without feature context
- [ ] Skip service layer
- [ ] Skip test layer
- [ ] Create files without corresponding files in other layers
- [ ] Import from higher layer (views → models OK, models → views WRONG)
- [ ] Mix multiple features in one file
- [ ] Use generic names (helpers.py, common.py) at app level

#### ✓ ALWAYS Do This
- [ ] Put business logic in services ONLY
- [ ] Keep views thin (< 50 lines)
- [ ] Keep models simple (data structure only)
- [ ] Use external CSS files (never inline)
- [ ] Create complete stack (Model → Service → View → Template → CSS → TS)
- [ ] Follow import hierarchy
- [ ] Group by feature, not by layer
- [ ] Use descriptive, feature-specific names
- [ ] Write tests for every layer
- [ ] Run validation before committing
- [ ] Use playwright to check from browser

### Validation Commands Checklist

Before EVERY commit, run:
```bash
# 1. Structure validation
python manage.py check_structure

# 2. Django checks
python manage.py check

# 3. All tests
python manage.py test

# 4. TypeScript compilation
cd apps/{app_name}/static/{app_name}/
tsc

# 5. Linting (if configured)
flake8 apps/
black apps/ --check

# 6. Structure verification
python ./scripts/maintenance/validate_app_structure.py
```

- [ ] All validation commands passed
- [ ] No errors in output
- [ ] No warnings ignored without reason

### Emergency Stop Checklist

STOP and ask for human review if:

- [ ] Not sure which layer code belongs to
- [ ] Want to put business logic in model
- [ ] Want to put business logic in view
- [ ] Want to create inline styles
- [ ] Want to skip service layer
- [ ] Want to skip test layer
- [ ] About to create utils.py or helpers.py
- [ ] About to import from higher layer
- [ ] Structure validation fails
- [ ] Tests are failing
- [ ] Not sure about file location
- [ ] Want to mix multiple features

### Quick Reference Card

**Creating browse feature:**
```
✓ models/repository/project.py      (data)
✓ services/repository/file_service.py (logic)
✓ views/repository/browse.py         (HTTP)
✓ forms/repository/file_form.py      (validation)
✓ templates/project_app/repository/browse.html (UI)
✓ static/project_app/css/repository/browse.css (style)
✓ static/project_app/ts/repository/browse.ts   (interaction)
✓ urls/repository.py                 (routing)
✓ tests/views/test_browse.py         (testing)
```

**Import pattern:**
```python
✓ View imports Service: from ...services.repository import FileService
✓ Service imports Model: from ...models.repository import Project
✓ View imports Model: from ...models.repository import Project  # Simple queries OK
✗ Model imports Service: NEVER
✗ Model imports View: NEVER
✗ Service imports View: NEVER
```

---

## Mandatory AI Agent Workflow

### Step 1: Read Guidelines
```
BEFORE writing ANY code:
1. Read DJANGO_ORGANIZATION_FULLSTACK.md completely
2. Understand 1:1:1:1 correspondence
3. Check current project structure
```

### Step 2: Plan Stack
```
BEFORE creating files, plan ALL layers:
1. What model(s) needed?
2. What service(s) needed?
3. What view(s) needed?
4. What template(s) needed?
5. What CSS file(s) needed?
6. What TS file(s) needed?
7. What test(s) needed?
```

### Step 3: Create in Order
```
MUST create in this order (no skipping):
1. Model
2. Service
3. View
4. Form (if needed)
5. Template
6. CSS
7. TypeScript
8. URL
9. Tests
```

### Step 4: Validate
```
AFTER creating files:
1. Run python manage.py check_structure
2. Run python manage.py test
3. Verify 1:1 correspondence
4. Check no inline styles
5. Verify layer separation
```

### Step 5: Review
```
BEFORE submitting:
□ All checklists completed
□ All files in correct locations
□ All tests passing
□ No guidelines violated
□ No inline styles
□ No business logic in wrong layer
```

---

## Enforcement

These checklists are MANDATORY. AI agents that skip items will:
1. Have their changes rejected
2. Be required to redo the work correctly
3. Must explain which guideline was violated

No exceptions. Follow the checklist every time.

---

<!-- EOF -->