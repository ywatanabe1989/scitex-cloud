{% load static %}
<!-- GitHub-Style Global Header -->
<header class="github-header">
  <div class="github-header-inner">
    <!-- Left: Logo + Main Navigation -->
    <div class="header-left">
      <!-- Logo -->
      <a href="/" class="header-logo">
        <i class="fas fa-flask"></i>
        <span>SciTeX</span>
      </a>

      <!-- Primary Navigation -->
      <nav class="header-nav">
        {% if user.is_authenticated %}
        <a href="/{{ user.username }}/?tab=repositories"
           class="header-nav-item {% if 'repositories' in request.path or request.GET.tab == 'repositories' %}active{% endif %}">
          <i class="fas fa-book"></i>
          <span class="nav-label">Repositories</span>
        </a>
        {% else %}
        <a href="/explore/?tab=repositories"
           class="header-nav-item {% if 'repositories' in request.path or request.GET.tab == 'repositories' %}active{% endif %}">
          <i class="fas fa-book"></i>
          <span class="nav-label">Repositories</span>
        </a>
        {% endif %}
        <a href="/scholar/"
           class="header-nav-item {% if 'scholar' in request.path or request.GET.mode == 'scholar' %}active{% endif %}">
          <i class="fas fa-graduation-cap"></i>
          <span class="nav-label">Scholar</span>
        </a>
        <a href="/code/"
           class="header-nav-item {% if 'code' in request.path or request.GET.mode == 'code' %}active{% endif %}">
          <i class="fas fa-code"></i>
          <span class="nav-label">Code</span>
        </a>
        <a href="/viz/"
           class="header-nav-item {% if 'viz' in request.path or request.GET.mode == 'viz' %}active{% endif %}">
          <i class="fas fa-chart-bar"></i>
          <span class="nav-label">Viz</span>
        </a>
        <a href="/writer/"
           class="header-nav-item {% if 'writer' in request.path or request.GET.mode == 'writer' %}active{% endif %}">
          <i class="fas fa-pen-nib"></i>
          <span class="nav-label">Writer</span>
        </a>
      </nav>
    </div>

    <!-- Center: Search -->
    <div class="header-center">
      <div class="header-search">
        <i class="fas fa-search header-search-icon"></i>
        <input type="text" placeholder="Search repositories, users..." id="global-search" autocomplete="off">
      </div>
    </div>

    <!-- Right: Actions + User Menu -->
    <div class="header-right">
      <!-- Theme Toggle (always visible) -->
      <button id="theme-toggle" class="theme-toggle" title="Toggle theme">
        ☀️
      </button>

      {% if user.is_authenticated %}
        <!-- New Repository Button (GitHub-style: /new) -->
        <a href="/new/" class="header-btn header-btn-primary" title="Create new repository">
          <i class="fas fa-plus"></i>
          <span class="btn-label">New</span>
        </a>

        <!-- Notifications (future) -->
        <a href="#" class="header-icon-btn" title="Notifications">
          <i class="fas fa-bell"></i>
        </a>

        <!-- User Menu -->
        <div class="header-user-menu">
          <button class="header-user-toggle" id="user-menu-toggle">
            <div class="header-avatar">
              {% if user.profile.avatar %}
                <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}">
              {% else %}
                {{ user.username|slice:":1"|upper }}
              {% endif %}
            </div>
            <i class="fas fa-caret-down" style="font-size: 12px; margin-left: 4px;"></i>
          </button>

          <div class="header-dropdown" id="user-menu-dropdown" style="display: none;">
            <!-- User Info Header -->
            <div class="dropdown-header">
              <div class="dropdown-user-info">
                <strong>{{ user.get_full_name|default:user.username }}</strong>
                <div class="dropdown-user-username">@{{ user.username }}</div>
              </div>
            </div>
            <div class="dropdown-divider"></div>

            <!-- Profile & Repositories -->
            <a href="/{{ user.username }}/" class="dropdown-item">
              <i class="fas fa-user"></i>
              Your profile
            </a>
            <a href="/{{ user.username }}/?tab=repositories" class="dropdown-item">
              <i class="fas fa-book"></i>
              Your repositories
            </a>
            <div class="dropdown-divider"></div>

            <!-- Settings -->
            <a href="{% url 'core_app:profile_edit' %}" class="dropdown-item">
              <i class="fas fa-cog"></i>
              Settings
            </a>
            <div class="dropdown-divider"></div>

            <!-- Developer Tools -->
            <a href="/dev/" class="dropdown-item">
              <i class="fas fa-tools"></i>
              Developer Tools
            </a>
            <a href="/dev/design/" class="dropdown-item">
              <i class="fas fa-palette"></i>
              Design System
            </a>
            <div class="dropdown-divider"></div>

            <!-- Support & Community -->
            <a href="https://github.com/SciTeX-AI" class="dropdown-item" target="_blank">
              <i class="fab fa-github"></i>
              GitHub
            </a>
            <a href="{% url 'cloud_app:donate' %}" class="dropdown-item">
              <i class="fas fa-heart"></i>
              Support SciTeX
            </a>
            <div class="dropdown-divider"></div>

            <!-- Sign Out -->
            <a href="{% url 'auth_app:logout' %}" class="dropdown-item">
              <i class="fas fa-sign-out-alt"></i>
              Sign out
            </a>
          </div>
        </div>
      {% else %}
        <!-- Not logged in -->
        <a href="{% url 'auth_app:login' %}" class="header-btn">
          Sign in
        </a>
        <a href="{% url 'auth_app:signup' %}" class="header-btn header-btn-primary">
          Sign up
        </a>
      {% endif %}
    </div>
  </div>
</header>

<!-- JavaScript for dropdown menu -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const userMenuToggle = document.getElementById('user-menu-toggle');
  const userMenuDropdown = document.getElementById('user-menu-dropdown');

  if (userMenuToggle && userMenuDropdown) {
    userMenuToggle.addEventListener('click', function(e) {
      e.stopPropagation();
      const isVisible = userMenuDropdown.style.display !== 'none';
      userMenuDropdown.style.display = isVisible ? 'none' : 'block';
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
      if (!userMenuToggle.contains(e.target) && !userMenuDropdown.contains(e.target)) {
        userMenuDropdown.style.display = 'none';
      }
    });

    // Close dropdown when pressing Escape
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        userMenuDropdown.style.display = 'none';
      }
    });
  }

  // Global search functionality (basic)
  const globalSearch = document.getElementById('global-search');
  if (globalSearch) {
    globalSearch.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        const query = this.value.trim();
        if (query) {
          // Redirect to search page (to be implemented)
          window.location.href = `/search/?q=${encodeURIComponent(query)}`;
        }
      }
    });
  }

  // Note: Theme toggle functionality is handled by /static/js/theme-switcher.js
});
</script>
